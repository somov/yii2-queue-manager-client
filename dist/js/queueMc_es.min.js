/*!
 * @license
 * yii2qmc 1.0.3 <https://github.com/somov/yii2-queue-manager-client#readme>
 * Copyright: somov.nn@gmail.com
 * Licensed under MIT
 */
!function(t,e){function s(t){return t&&'object'==typeof t&&'default'in t?t:{default:t}}var a=s(t),n=s(e);function i(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function r(t,e){return u(t,o(t,e,'get'))}function l(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError('attempted to set read only private field');e.value=s}}(t,o(t,e,'set'),s),s}function o(t,e,s){if(!e.has(t))throw new TypeError('attempted to '+s+' private field on non-instance');return e.get(t)}function c(t,e,s){return d(t,e),function(t,e){if(void 0===t)throw new TypeError('attempted to '+e+' private static field before its declaration')}(s,'get'),u(t,s)}function h(t,e,s){return d(t,e),s}function u(t,e){return e.get?e.get.call(t):e.value}function d(t,e){if(t!==e)throw new TypeError('Private static access of wrong provenance')}function p(t,e,s){if(!e.has(t))throw new TypeError('attempted to get private field on non-instance');return s}const f={prefixed:!0},m=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror','fullscreen'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror','-webkit-full-screen'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror','-moz-full-screen'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError','-ms-fullscreen']],g=m[0];let w;for(let t=0;t<m.length;t++)if(m[t][1]in a.default){w=m[t];break}if(w){for(let t=0;t<w.length;t++)f[g[t]]=w[t];f.prefixed=w[0]!==g[0]}const b=Object.prototype.toString;function v(t,e){(t=>E(t)?Object.keys(t):[])(t).forEach((s=>e(t[s],s)))}function E(t){return!!t&&'object'==typeof t}function k(t,e){if(!t||!e)return'';if('function'==typeof n.default.getComputedStyle){const s=n.default.getComputedStyle(t);return s?s.getPropertyValue(e)||s[e]:''}return''}const y=n.default.navigator&&n.default.navigator.userAgent||'',T=/AppleWebKit\/([\d.]+)/i.exec(y);T&&parseFloat(T.pop()),/iPod/i.test(y),(()=>{const t=y.match(/OS (\d+)_/i);t&&t[1]&&t[1]})();const C=/Android/i.test(y);(()=>{const t=y.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const e=t[1]&&parseFloat(t[1]),s=t[2]&&parseFloat(t[2]);e&&s&&parseFloat(t[1]+'.'+t[2])})(),/Firefox/i.test(y);const N=/Edg/i.test(y),x=!N&&(/Chrome/i.test(y)||/CriOS/i.test(y));(()=>{const t=y.match(/(Chrome|CriOS)\/(\d+)/);t&&t[2]&&parseFloat(t[2])})(),(()=>{const t=/MSIE\s(\d+)\.\d/.exec(y);let e=t&&parseFloat(t[1]);!e&&/Trident\/7.0/i.test(y)&&/rv:11.0/.test(y)&&(e=11)})();const O=/Safari/i.test(y)&&!x&&!C&&!N;/Windows/i.test(y);const A=Boolean(a.default===n.default.document&&('ontouchstart'in n.default||n.default.navigator.maxTouchPoints||n.default.DocumentTouch&&n.default.document instanceof n.default.DocumentTouch));/iPad/i.test(y)||O&&A&&/iPhone/i.test(y);function S(t){return'string'==typeof t&&Boolean(t.trim())}function M(t){if(t.indexOf(' ')>=0)throw new Error('class has illegal whitespace characters')}function W(t){return E(t)&&1===t.nodeType}function P(t){return(e,s)=>{if(!S(e))return a.default[t](null);S(s)&&(s=a.default.querySelector(s));const n=W(s)?s:a.default;return n[t]&&n[t](e)}}function L(t='div',e={},s={},n){const i=a.default.createElement(t);return Object.getOwnPropertyNames(e).forEach((t=>{const s=e[t];-1!==t.indexOf('aria-')||'role'===t||'type'===t?i.setAttribute(t,s):'style'===t&&'object'==typeof s?Object.getOwnPropertyNames(s).forEach((t=>{i.style[t]=s[t]})):'textContent'===t?function(t,e){void 0===t.textContent?t.innerText=e:t.textContent=e}(i,s):i[t]===s&&'tabIndex'!==t||(i[t]=s)})),Object.getOwnPropertyNames(s).forEach((t=>{i.setAttribute(t,s[t])})),n&&function(t,e){(function(t){'function'==typeof t&&(t=t());return(Array.isArray(t)?t:[t]).map((t=>('function'==typeof t&&(t=t()),W(t)||function(t){return E(t)&&3===t.nodeType}(t)?t:'string'==typeof t&&/\S/.test(t)?a.default.createTextNode(t):void 0))).filter((t=>t))})(e).forEach((e=>t.appendChild(e)))}(i,n),i}function R(t,e){return M(e),t.classList?t.classList.contains(e):(s=e,new RegExp('(^|\\s)'+s+'($|\\s)')).test(t.className);var s}function _(t,e){return t.classList?t.classList.add(e):R(t,e)||(t.className=(t.className+' '+e).trim()),t}function I(t,e){return t.classList?t.classList.remove(e):(M(e),t.className=t.className.split(/\s+/).filter((t=>t!==e)).join(' ')),t}function j(t,e){t.removeAttribute(e)}function F(t,e,s,a=(t=>t.startsWith(s)?t:'')){let n='';t.classList.forEach((t=>{0===n.length&&(n=a(t))})),n!==e&&(n.length>0&&I(t,n),_(t,e))}var z;/iPhone/i.test(y),(z=Element.prototype).matches=z.matches||z.mozMatchesSelector||z.msMatchesSelector||z.oMatchesSelector||z.webkitMatchesSelector,z.closest=z.closest||function(t){return this?this.matches(t)?this:this.parentElement?this.parentElement.closest(t):null:null};const q=P('querySelector'),D=P('querySelectorAll');class ${static removeOptionsPtoperty(t,e,s=Element){if(e[t]instanceof s==!1)throw Error('Invalid call. Property '+t+' is not valid');{const s=e[t];return delete e[t],s}}createEl(t='div',e={},s={},a){if(void 0!==e.className){const t=new Set;('string'==typeof e.className?e.className.split(' '):e.className).forEach((e=>t.add(e)));let s='';for(let e of t)s+=' '+$.getClassName(e);e.className=s.trim()}return L(t,e,s,a)}static _normalizePrefix(t){return t.replace(new RegExp('\\.','g'),'$&'+$.classPrefix)}$(t,e){return t=$._normalizePrefix(t),q(t,e)}$$(t,e){return t=$._normalizePrefix(t),D(t,e)}}Object.assign($,{classPrefix:null,getClassName:function(t){return null===this.classPrefix||t.startsWith(this.classPrefix)?t:this.classPrefix+t}});var B,H=(((t,e)=>{var s;s=t=>{t.version='1.2.0';var e=(()=>{for(var t=0,e=new Array(256),s=0;256!=s;++s)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=s)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[s]=t;return'undefined'!=typeof Int32Array?new Int32Array(e):e})();t.table=e,t.bstr=(t,s)=>{for(var a=-1^s,n=t.length-1,i=0;i<n;)a=(a=a>>>8^e[255&(a^t.charCodeAt(i++))])>>>8^e[255&(a^t.charCodeAt(i++))];return i===n&&(a=a>>>8^e[255&(a^t.charCodeAt(i))]),-1^a},t.buf=(t,s)=>{if(t.length>1e4)return((t,s)=>{for(var a=-1^s,n=t.length-7,i=0;i<n;)a=(a=(a=(a=(a=(a=(a=(a=a>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])];for(;i<n+7;)a=a>>>8^e[255&(a^t[i++])];return-1^a})(t,s);for(var a=-1^s,n=t.length-3,i=0;i<n;)a=(a=(a=(a=a>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])])>>>8^e[255&(a^t[i++])];for(;i<n+3;)a=a>>>8^e[255&(a^t[i++])];return-1^a},t.str=(t,s)=>{for(var a,n,i=-1^s,r=0,l=t.length;r<l;)(a=t.charCodeAt(r++))<128?i=i>>>8^e[255&(i^a)]:a<2048?i=(i=i>>>8^e[255&(i^(192|a>>6&31))])>>>8^e[255&(i^(128|63&a))]:a>=55296&&a<57344?(a=64+(1023&a),n=1023&t.charCodeAt(r++),i=(i=(i=(i=i>>>8^e[255&(i^(240|a>>8&7))])>>>8^e[255&(i^(128|a>>2&63))])>>>8^e[255&(i^(128|n>>6&15|(3&a)<<4))])>>>8^e[255&(i^(128|63&n))]):i=(i=(i=i>>>8^e[255&(i^(224|a>>12&15))])>>>8^e[255&(i^(128|a>>6&63))])>>>8^e[255&(i^(128|63&a))];return-1^i}},'undefined'==typeof DO_NOT_EXPORT_CRC?s(e):s({})})(B={exports:{}},B.exports),B.exports);function X(t){return t&&'object'==typeof t&&!Array.isArray(t)}function V(t,...e){if(!e.length)return t;const s=e.shift();if(X(t)&&X(s))for(const e in s)X(s[e])?(t[e]||Object.assign(t,{[e]:{}}),V(t[e],s[e])):Object.assign(t,{[e]:s[e]});return V(t,...e)}const G={INIT:-1,WAIT:0,EXEC:1,DONE:2,ERROR:3,DELETED:99};G.SET_VISIBLE=[G.WAIT,G.EXEC,G.ERROR,G.DONE],G.SET_COMPLETE=[G.DONE,G.ERROR,G.DELETED],G.is=(t,e)=>t.indexOf(e)>-1;var U=new WeakMap,Y=new WeakMap,K=new WeakSet;class J extends ${constructor(t,e){super(),K.add(this),U.set(this,{writable:!0,value:null}),i(this,'id',void 0),i(this,'common',!1),i(this,'initiatorManager',void 0),i(this,'progress',0),i(this,'text',''),i(this,'title',''),i(this,'status',G.INIT),Y.set(this,{writable:!0,value:null}),i(this,'callbacks',{init:null,render:null,show:null,refresh:null,hide:null,remove:null}),i(this,'result',null),this.id=parseInt(t),l(this,U,e),setTimeout((()=>this.callCallback('init')),50)}callCallback(t,e=[]){this.common||'function'==typeof this.callbacks[t]&&this.callbacks[t].apply(this,e)}get el(){return r(this,Y)}_renderChild(t){}_buildCssClass(){return['task-item']}cssClassSwitch(){const t=p(this,K,Q).call(this);let e,s;if('object'==typeof this.manager.options.theme){let a=this.manager.options.theme[this.status]||!1;a&&(e=J.getClassName('theme-'+a),s=J.getClassName('theme'),F(t,e,s))}e=c(J,J,Z).call(J)[this.status],s=J.getClassName('status'),F(t,e,s)}refresh(t,e=null){p(this,K,Q).call(this),e&&this._refreshElements(e,t),this.callCallback('refresh',[t,e])}getProgressTotal(t='progress'){let e=0;return this.hasOwnProperty(t)&&(e=this[t],'object'==typeof e&&e.length&&(e=Math.round(e.reduce(((t,e)=>t+e))/e.length,0))),e}_refreshElements(t,e){const s=this.options.parts;Object.keys(t).forEach((a=>{let n=s[a],i='refreshBasicProperty';if('string'==typeof n){if(n.indexOf('.')>0){let[t,e]=n.split('.');i=t+e[0].toUpperCase()+e.slice(1),n=e}const s=void 0!==this[n]?this[n]:null;s!==(void 0!==e[n]?e[n]:null)&&(i='_'+i,'function'==typeof this[i]&&this[i].call(this,t[a],s,n))}}))}_refreshBasicProperty(t,e,s){if(Array.isArray(e)){const a=J.getClassName('list-'+s);let n=q('ul.'+a,t);null===n&&(n=this.createEl('ul',{className:a}),t.append(n)),e.forEach(((t,e)=>{let s=q(`li:nth-child(${e+1})`,n);null===s?n.append(L('li',{},{},t)):s.innerText!==t&&(s.innerText=t)}))}else t.innerHTML=e}get manager(){return r(this,U)}get element(){return r(this,Y)}get options(){return this.manager.options.taskOptions}get statusText(){return this.manager.options.statusText[this.status]||''}getTitle(){return''}toString(){return this.statusText+' '+this.getTitle()}}function Q(){if(r(this,Y))return r(this,Y);const t=l(this,Y,this.createEl('div',{className:'wrapper'},{'data-task-id':this.id})),e=this.createEl('div',{className:this._buildCssClass()});return this._renderChild(e),this.callCallback('render',[e,t]),t.append(e),t}var Z={writable:!0,value:function(){if(this._cssList)return this._cssList;this._cssList={};for(let t in G)'number'==typeof G[t]&&(this._cssList[G[t]]=$.getClassName('status-'+t.toLowerCase()));return this._cssList}};const tt='__EMPTY__',et={method:'post',delayTime:1e3,params:{}};var st=new WeakMap,at=new WeakMap,nt=new WeakMap,it=new WeakSet,rt=new WeakSet,lt=new WeakSet;class ot{constructor(t){lt.add(this),rt.add(this),it.add(this),st.set(this,{writable:!0,value:[]}),at.set(this,{writable:!0,value:void 0}),nt.set(this,{writable:!0,value:-1});const e=l(this,at,V({},et,t));var s;e.params&&(E(s=e.params)&&'[object Object]'===b.call(s)&&s.constructor===Object)&&(e.params=Object.entries(e.params).map((([t,e])=>`${t}=${e}`)))}resolve(t,e){if(!1===this.isRunning){const s=p(this,lt,dt).call(this);l(this,nt,0),s.forEach((e=>t(e))),p(this,it,ct).call(this,0).catch((t=>{})).then((()=>{const t=r(this,nt);return s.forEach((s=>e(s,t))),l(this,nt,-1),t}))}}get tasks(){let t=[];return r(this,st).forEach((e=>{e.getTasks().forEach((e=>{!1===e.common&&t.push(e)}))})),t}get tasksId(){return this.tasks.map((t=>t.id)).filter(((t,e,s)=>s.indexOf(t)===e))}findTasks(t){return this.tasks.filter((e=>e.id===t))}get options(){return r(this,at)}get isRunning(){return r(this,nt)>-1}static factory(t){const e=t.options.resolver,s=H.str(e.url),a=c(ot,ot,pt),n=c(ot,ot,ft),i=a[s]=a[s]instanceof ot?a[s]:new ot(e),r=p(i,lt,dt).call(i);return-1===r.indexOf(t)&&(r.push(t),t.options.common&&n.push(t),t.ownerElement.addEventListener(ye.Events.destroy,(t=>{let e=r.indexOf(t.manager);e>-1&&(n.forEach((t=>{t.getTasks().filter((t=>t.initiatorManager===r[e])).forEach((e=>{t.removeTask(e)}))})),r.splice(e,1)),e=n.findIndex((e=>e===t.manager)),e>-1&&n.splice(e,1)}))),i}}function ct(t=this.options.delayTime){return p(this,rt,ut).call(this,t).then((t=>{if(!1===t.ok)throw Error(`${t.status} - ${t.statusText}' `);return t.json().then((t=>(t.length>0&&(t.forEach((t=>{this.findTasks(t.id).forEach((e=>{e.manager._updateTask(e,t)}))})),h(ot,ot,ht).call(ot,t,this)),p(this,it,ct).call(this))))}))}function ht(t,e){c(ot,ot,ft).forEach((s=>{t.forEach((t=>{let a=s.findTask(t.id);null===a&&!1===G.is(G.SET_COMPLETE,t.status)&&(t.common=!0,s.addTasks([t.id],!1),a=s.findTask(t.id),s._updateTask(a,t),a.initiatorManager=e.tasks.find((e=>e.id===t.id))?.manager),a instanceof J&&a.common&&s._updateTask(a,t)}))}))}function ut(t){return new Promise(((e,s)=>{const a=this.tasksId;0===a.length?s(tt):setTimeout((()=>e(a)),t)})).then((t=>{l(this,nt,+r(this,nt)+1);let e=t.map((t=>`t[]=${t}`)),s=this.options.params;return Array.isArray(s)&&s.length>0&&(e=e.concat(s)),fetch(this.options.url,V({},this.options,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:encodeURI(e.join('&'))}))}))}function dt(t=!1){return!1===t?r(this,st):r(this,st).filter((t=>!0===t.options.common))}var pt={writable:!0,value:[]},ft={writable:!0,value:[]};const mt={ready:'qmc:manager:ready',destroy:'qmc:manager:destroy',statusChange:'qmc:manager:statusChange',taskRemoved:'qmc:manager:taskRemoved',taskElementAppend:'qmc:manager:taskElementAppend',taskElementRemoved:'qmc:manager:taskElementRemoved',newTask:'qmc:manager:newTask',fetchStart:'qmc:resolver:start',fetchEnd:'qmc:resolver:end',toString:function(){const t=[];return v(this,(e=>{t.push(e)})),t.join(' ')}};var gt=new WeakMap;class wt extends CustomEvent{constructor(t,e,s){super(e,s),gt.set(this,{writable:!0,value:null}),l(this,gt,t)}get manager(){return r(this,gt)}}let bt,vt=3;n.default.WeakMap||(bt=class{constructor(){this.vdata='vdata'+Math.floor(n.default.performance&&n.default.performance.now()||Date.now()),this.data={}}set(t,e){const s=t[this.vdata]||vt++;return t[this.vdata]||(t[this.vdata]=s),this.data[s]=e,this}get(t){const e=t[this.vdata];if(e)return this.data[e]}has(t){return t[this.vdata]in this.data}delete(t){const e=t[this.vdata];e&&(delete this.data[e],delete t[this.vdata])}});var Et=n.default.WeakMap?new WeakMap:new bt,kt=new WeakMap,yt=new WeakMap,Tt=new WeakMap,Ct=new WeakSet;class Nt extends ${constructor(...t){super(),Ct.add(this),i(this,'label',''),i(this,'className',Nt.getClassName('progress')),i(this,'size',null),kt.set(this,{writable:!0,value:[]}),i(this,'barOptions',{}),yt.set(this,{writable:!0,value:null}),Tt.set(this,{writable:!0,value:null}),i(this,'isShowGradient',!0),V(this,...t)}render(){let t=r(this,Tt);if(t instanceof HTMLElement)return t;let e=this.className;return this.size&&(e+=' '+Nt.getClassName('size-'+this.size)),!1===this.isShowGradient&&(e+=' '+Nt.getClassName('no-gradient')),t=L('div',{className:e},{},L('div',{className:Nt.getClassName('progress-items')})),l(this,Tt,t)}setProgress(t){const e=r(this,kt),s=r(this,Tt);t.length,(t='number'==typeof t?[t]:t).forEach(((t,a)=>{e[a]instanceof St?e[a].progress=t:(e[a]=new St(this.barOptions,{progress:t}),s.querySelector('.'+Nt.getClassName('progress-items')).append(L('div',{className:Nt.getClassName('progress-item')},{},e[a].render())))}));const a=Nt.getClassName('more-than-three');!1===R(s,a)&&t.length>3&&_(s,a)}setLabel(t){t&&(p(this,Ct,xt).call(this).innerHTML=t)}}function xt(){let t=r(this,yt);return t instanceof Element||(l(this,yt,t=L('span',{className:Nt.getClassName('progress-label')},{})),r(this,Tt).append(t)),t}i(Nt,'$classPrefix',null);var Ot=new WeakMap,At=new WeakMap;class St{constructor(...t){Ot.set(this,{writable:!0,value:!1}),i(this,'className','progress-bar'),At.set(this,{writable:!0,value:0}),i(this,'labelText',''),i(this,'min',0),i(this,'max',100),V(this,...t)}render(){let t=r(this,Ot);if(t)return t;let e=[];return!1===this.labelText?e.push(L('span',{className:'sr-only',css:{width:0}},{},this.label)):e=this.label,l(this,Ot,t=L('div',{className:Nt.getClassName(this.className)},{role:'progressbar','aria-valuenow':this.progress,'aria-valuemin':this.min,'aria-valuemax':this.max},e)),t}get label(){const t=this.labelText?this.labelText:'';return`${this.progress}% ${t}`}get progress(){return r(this,At)}set progress(t){l(this,At,t);const e=this.render();e.setAttribute('aria-valuenow',t),e.childNodes.length>0?e.childNodes[0].textContent=this.label:e.textContent=this.label,e.style.width=`${t}%`}}var Mt=new WeakMap,Wt=new WeakMap,Pt=new WeakMap,Lt=new WeakSet;class Rt extends ${constructor(t=!1,e=!1){super(),Lt.add(this),Mt.set(this,{writable:!0,value:void 0}),Wt.set(this,{writable:!0,value:!1}),Pt.set(this,{writable:!0,value:!1}),l(this,Wt,t),l(this,Pt,e)}render(){let t=r(this,Mt);return t instanceof Element?t:l(this,Mt,this.createEl('span',{className:p(this,Lt,_t).call(this)},{},L('span',{},{},['s1','s2','s3'].map((t=>L('span',{className:t}))))))}set icon(t){if(t){let e=r(this,Wt);if(e!==t){const s=r(this,Mt);e&&I(s,e),_(s,t),l(this,Wt,t)}}}set size(t){if(t){t=Rt.getClassName('size-'+t);const e=r(this,Pt);if(e!==t){const s=r(this,Mt);e&&I(s,e),_(s,t),l(this,Pt,t)}}}set color(t){D('span[class^=s]',r(this,Mt)).forEach((e=>{e.style.backgroundColor=t}))}}function _t(){let t='icon-t',e=[];return r(this,Wt)&&(t+=' '+r(this,Wt)),e.push(t),r(this,Pt)&&e.push('size-'+r(this,Pt)),e}const It={tagName:'button',handler:null,handlerTimoutDelay:500,label:!1,hiddenLabel:'',disabled:!1,size:null,iconName:null,iconHoverName:null,iconSize:null,animatedClick:!0,data:{}};var jt=new WeakMap,Ft=new WeakMap,zt=new WeakMap,qt=new WeakSet;class Dt extends ${constructor(t){super(),qt.add(this),jt.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:It}),zt.set(this,{writable:!0,value:null}),t&&'object'==typeof t&&l(this,Ft,V({},It,t))}render(){let t=r(this,jt);if(t instanceof Element)return t;const e=this.options,s=[];if(e.iconName){const t=this.icon;s.push(t.render()),t.icon=e.iconName,t.size=e.iconSize}if(e.label&&s.push(L('p',{},{},e.label)),e.hiddenLabel&&s.push(this.createEl('p',{className:'button-hidden'},{},e.hiddenLabel)),e.animatedClick){const t=L('p',{className:'drop'});t.addEventListener('animationend',(function(){I(this,'animate')})),s.push(t)}return t=l(this,jt,this.createEl(e.tagName,{className:h(Dt,Dt,$t).call(Dt,e)},{},s)),this.disabled=e.disabled,p(this,qt,Bt).call(this,t,e),t}set disabled(t){const e=this.options;t!==e.disabled&&('button'===e.tagName.toLowerCase()?r(this,jt).disabled=t:function(t,e,s){const a=R(t,e);if('function'==typeof s&&(s=s(t,e)),'boolean'!=typeof s&&(s=!a),s!==a)s?_(t,e):I(t,e)}(r(this,jt),'disabled'),e.disabled=t)}get options(){return r(this,Ft)}get element(){return this.render()}get icon(){let t=r(this,zt);return t instanceof Rt?t:l(this,zt,new Rt)}}function $t(t){let e=['button'];return t.size&&e.push('size-'+t.size),t.hiddenLabel&&e.push('has-hidden'),e}function Bt(t,e){t.addEventListener('click',(s=>{if(e.disabled)return s.stopImmediatePropagation(),!1;e.animatedClick&&h(Dt,Dt,Ht).call(Dt,t)})),'function'==typeof e.handler&&(e.handlerTimoutDelay>0?t.addEventListener('click',(t=>{setTimeout((()=>e.handler.call(this,t)),e.handlerTimoutDelay)})):t.addEventListener('click',e.handler.bind(this))),e.iconHoverName&&(t.addEventListener('mouseenter',(()=>{!1===e.disabled&&(this.icon.icon=e.iconHoverName)})),t.addEventListener('mouseleave',(()=>{this.icon.icon=e.iconName})))}function Ht(t){const e=q('.drop',t);if(e){const s=function(t){if(t&&t.getBoundingClientRect&&t.parentNode){const e=t.getBoundingClientRect(),s={};return['bottom','height','left','right','top','width'].forEach((t=>{void 0!==e[t]&&(s[t]=e[t])})),s.height||(s.height=parseFloat(k(t,'height'))),s.width||(s.width=parseFloat(k(t,'width'))),s}}(t),a=event.pageX-s.width/2-s.left-window.scrollX,n=event.pageY-s.height/2-s.top-window.scrollY;e.style.top=n+'px',e.style.left=a+'px',_(e,'animate')}}Dt.Defaults=It;const Xt={buttons:[],arrange:!1,scaled:!1,selectable:!1,selectIcon:null};var Vt=new WeakMap,Gt=new WeakMap,Ut=new WeakSet;class Yt extends ${constructor(t){super(),Ut.add(this),i(this,'buttons',null),Vt.set(this,{writable:!0,value:Xt}),Gt.set(this,{writable:!0,value:void 0});const e=$.removeOptionsPtoperty('buttons',t,Array);l(this,Vt,V({},Xt,t)),this.buttons=e.map((t=>new Dt(t)))}render(){let t=r(this,Gt);return t instanceof Element||(l(this,Gt,t=this.createEl('div',{className:h(Yt,Yt,Kt).call(Yt,this.options)},{},this.buttons.map((t=>t.render())))),this.options.selectable&&p(this,Ut,Jt).call(this,t)),t}get options(){return r(this,Vt)}set arrange(t){const e=Yt.getClassName('arrange');let s=r(this,Gt),a=r(this,Vt);s&&(t?!1===R(s,e)&&_(s,e):I(s,e)),a.arrange=t}set selected(t){const e=Yt.getClassName('selected'),s=this.options;'number'==typeof t&&(t=this.buttons[t]),t instanceof Dt&&(this.buttons.forEach((t=>{j(t.element,'data-group-selected'),I(t.element,e)})),_(t.element,e),s.selectIcon&&(t.icon.icon=s.selectIcon,t.options.iconName=s.selectIcon))}}function Kt(t){let e=['button-group'];return t.arrange&&e.push('arrange'),t.scaled&&e.push('scaled'),e}function Jt(t){t.addEventListener('click',(t=>{const e=t.target.closest('.'+Yt.getClassName('button'));this.selected=this.buttons.find((t=>t.element===e))})),t.addEventListener('mouseenter',(t=>{this.$$('.button.selected',t.target).forEach((t=>{!function(t,e,s){t.setAttribute(e,s)}(t,'data-group-selected',!0),I(t,Yt.getClassName('selected'))}))})),t.addEventListener('mouseleave',(t=>{this.$$('.button[data-group-selected]',t.target).forEach((t=>{j(t,'data-group-selected'),_(t,Yt.getClassName('selected'))}))}))}var Qt=new WeakMap,Zt=new WeakMap,te=new WeakMap,ee=new WeakMap,se=new WeakMap;class ae extends ${constructor(t,e,s){super(),Qt.set(this,{writable:!0,value:[]}),i(this,'map',{icons:[],actions:[]}),Zt.set(this,{writable:!0,value:void 0}),te.set(this,{writable:!0,value:null}),ee.set(this,{writable:!0,value:null}),se.set(this,{writable:!0,value:null}),l(this,Zt,t),this.map.icons=e,this.map.actions=s,l(this,te,new Rt('none','big')),l(this,ee,this.createEl('span',{className:'status-text'})),s.forEach((e=>{V(e,{data:{task:t}})}))}render(){let t=r(this,Qt);return t.length>0||(t.push(r(this,te).render()),t.push(r(this,ee)),this.map.actions.length>0&&(l(this,se,new Yt({buttons:this.map.actions,arrange:!1,scaled:!0})),t.push(r(this,se).render()))),t}refresh(t){r(this,ee).innerHTML=r(this,Zt).statusText,r(this,te).icon=this.map.icons[t];const e=r(this,se);e&&e.buttons.forEach((e=>{let s=e.options?.enabledWithStatus;if('function'==typeof s&&(s=s.call(e,t)),Array.isArray(s)){if(0===e.options.enabledWithStatus.length)return;e.disabled=-1===e.options.enabledWithStatus.indexOf(t)}else'boolean'==typeof s&&(e.disabled=s)}))}}const ne={iconPlacement:'default',parts:{status:'refresh.status',title:'title',text:'text',error:'errors','progress-wrapper':'refresh.progress'},progress:{label:'',size:'',barOptions:{labelText:!1}},actions:[]},ie={};ie[G.WAIT]='clock',ie[G.EXEC]='play',ie[G.ERROR]='warning',ie[G.DONE]='checked';var re=new WeakMap;class le extends J{constructor(...t){super(...t),re.set(this,{writable:!0,value:{}})}_renderChild(t){const e=r(this,re),s=this.options,a=t.appendChild(this.createEl('div',{className:'detail'})),n=t.appendChild(this.createEl('div',{className:'status-wrapper'}));Object.keys(s.parts).forEach((t=>{let i=a,r=null;if('progress-wrapper'===t?s.progress?r=new Nt(s.progress):delete s['progress-wrapper']:'status'===t&&(i=n,r=new ae(this,ie,s.actions)),e[t]=i.appendChild(this.createEl('div',{className:t},{})),r&&'function'==typeof r?.render){let s=r.render();s instanceof Element&&(s=[s]),s.forEach((s=>e[t].append(s))),h(le,le,oe).call(le,e[t],r)}}))}refresh(t){super.refresh(t,r(this,re))}_buildCssClass(){const t=super._buildCssClass();return this.options.iconPlacement!==ne.iconPlacement&&t.push('task-item-'+this.options.iconPlacement),t}_refreshProgress(t,e){const s=h(le,le,ce).call(le,t);s instanceof Nt&&(s.setLabel(this.getProgressTotal()+'%'),s.setProgress(e))}_refreshStatus(t,e){h(le,le,ce).call(le,t).refresh(e)}getTitle(){const t=this.options.parts.title;return t?this[t]??'':''}}function oe(t,e){Et.has(t)||Et.set(t,{});Et.get(t).componet=e}function ce(t){if(Et.has(t)){const e=Et.get(t);if(void 0!==e.componet)return e.componet}return null}le.Defualts=ne;const he={linear:t=>t,quad:t=>Math.pow(t,2),circ:t=>1-Math.sin(Math.acos(t)),back:(t=1.5,e)=>Math.pow(e,2)*((t+1)*e-t)},ue={fadeOut:function(t){this.style.opacity=1-Math.round(100*t)/100},fadeIn:function(t){'none'===this.style.display&&(this.style.display=null),this.style.opacity=Math.round(100*t)/100}};function de(t,e={name:'fadeOut',timing:he.linear,duration:500,delay:0}){let s=Object.assign({},e);if('function'==typeof s.draw)s.draw.bind(t);else{if('string'!=typeof s.name||'function'!=typeof ue[s.name])throw new Error('Unknown animation ');s.draw=ue[s.name].bind(t)}return'number'!=typeof s.delay&&(s.delay=0),s.timing='string'==typeof s.timing&&'function'==typeof he[s.timing]?he[s.timing]:he.linear,new Promise((e=>{setTimeout((()=>function({timing:t,draw:e,duration:s},a){let n=performance.now();requestAnimationFrame((function i(r){let l=(r-n)/s;l>1&&(l=1);let o=t(l);e(o),l<1?requestAnimationFrame(i):a&&a()}))}(s,(()=>{e(t)}))),s.delay)}))}const pe={common:!1,title:'<h3>Backgrounds tasks</h3>',theme:{'-1':'default'},renderOnEmpty:!0,taskClass:le,emptyText:'Tasks not provided yet',taskOptions:{},tasks:[],statusText:{},hideAnimation:{name:'fadeOut',duration:1e3,timing:'linear',delay:0},showAnimation:{name:'fadeIn',duration:1e3,timing:'linear',delay:0},tasksAnimation:{hide:{},show:{}},resolver:{url:'queue-reader'}};pe.tasksAnimation.hide[G.DONE]=V({},pe.hideAnimation,{delay:5e3}),pe.tasksAnimation.hide[G.ERROR]=V({},pe.hideAnimation,{delay:2e4}),pe.tasksAnimation.show[G.EXEC]=V({},pe.showAnimation,{duration:500}),pe.tasksAnimation.show[G.WAIT]=V({},pe.showAnimation,{duration:500}),pe.tasksAnimation.hide[G.ERROR]=!1,pe.statusText[G.DONE]='Complete',pe.statusText[G.ERROR]='Complete with errors',pe.statusText[G.EXEC]='Processing',pe.statusText[G.WAIT]='Awaiting';var fe=new WeakMap,me=new WeakMap,ge=new WeakMap,we=new WeakMap,be=new WeakSet,ve=new WeakSet,Ee=new WeakSet,ke=new WeakSet;class ye extends ${constructor(t){super(),ke.add(this),Ee.add(this),ve.add(this),be.add(this),fe.set(this,{writable:!0,value:null}),me.set(this,{writable:!0,value:{owner:null,wrapper:null,wrapperTasks:null,emptyText:null}}),ge.set(this,{writable:!0,value:[]}),we.set(this,{writable:!0,value:{}}),r(this,me).owner=$.removeOptionsPtoperty('element',t);let e=V({},ye.Defaults,t);l(this,we,V({},{taskOptions:e.taskClass.Defualts},e)),l(this,fe,ot.factory(this)),this.render(),t.tasks&&void 0!==t.tasks.length&&this.addTasks(t.tasks),setTimeout((()=>{0===this.getTasks().length&&p(this,be,Te).call(this,'show')}),200),this.trigger(mt.ready,{bubbles:!0})}destroy(){this.trigger(mt.destroy,{bubbles:!0}),l(this,ge,[]),this.ownerElement.remove()}get options(){return r(this,we)}trigger(t,e={},s){if('object'==typeof s){e.detail={};for(const[t,a]of Object.entries(s))e.detail[t]=a}return this.ownerElement.dispatchEvent(new wt(this,t,e))}render(){const t=this.getTasks(G.SET_VISIBLE);if(0===t.length&&!1===this.options.renderOnEmpty)return!1;const e=r(this,me);if(null===e.wrapper){const t=this.options;e.wrapper=e.owner.appendChild(this.createEl('div',{className:'wrapper'})),0===e.wrapper.childNodes.length&&(t.title&&this.options.title.length>0&&e.wrapper.appendChild(this.createEl('div',{innerHTML:this.options.title,className:'title'})),e.wrapperTasks=e.wrapper.appendChild(this.createEl('div',{className:'tasks'})),t.emptyText.length>0&&(e.emptyText=e.wrapper.appendChild(e.emptyText=this.createEl('div',{className:'empty-wrapper',style:{display:'none'}},{},[this.createEl('span',{className:'empty-text',textContent:t.emptyText})])))),'string'==typeof t.theme&&F(e.wrapper,ye.getClassName('theme-'+t.theme),ye.getClassName('theme'))}return t.forEach((t=>t.refresh())),!0}addTasks(t,e=!0){if(!1===Array.isArray(t))throw new Error('Not valid call. Argument tasks is not array type ');p(this,Ee,Ne).call(this,t),l(this,ge,r(this,ge).concat(t)),t.forEach((t=>this.trigger(mt.newTask,{bubbles:!0},{task:t}))),p(this,be,Te).call(this,'hide').then((()=>{e&&this.resolver.resolve((t=>{t.getTasks().length>0&&t.trigger(mt.fetchStart,{bubbles:!0})}),((t,e)=>{t.trigger(mt.fetchEnd,{bubbles:!0},{requests:e})}))}))}_updateTask(t,e){if(t.progress!==e.progress||t.status!==e.status||t.text!==e.text||t.title!==e.title){const s=t.status!==e.status,a=V({},t);if((t=V(t,e)).refresh(a),s){if(t.cssClassSwitch(),this.trigger(mt.statusChange,{bubbles:!0},{task:t,oldStatus:a.status}),G.is(G.SET_VISIBLE,t.status)&&null===t.element.parentNode){const e=t.element;e.style.display='none',this.wrapperTasksElement.append(e),de(e,p(this,ve,Ce).call(this,t,'show')).then((()=>{this.trigger(mt.taskElementAppend,{bubbles:!0},{task:t}),t.callCallback('show')}))}G.is(G.SET_COMPLETE,t.status)&&(this.removeTask(t),!1===t.manager.options.common&&t.result&&Array.isArray(t.result.tasks)&&t.manager.addTasks(t.result.tasks))}}}removeTask(t){if('number'==typeof t&&(t=this.findTask(t)),t instanceof J){const e=this.getTasks().findIndex((e=>e.id===t.id));if(e>-1)return r(this,ge).splice(e,1),this.trigger(mt.taskRemoved,{bubbles:!0},{task:t}),t.callCallback('remove'),t.element.parentNode instanceof Element&&p(this,ke,xe).call(this,t.element,p(this,ve,Ce).call(this,t)).then((e=>{t.callCallback('hide'),this.trigger(mt.taskElementRemoved,{bubbles:!0},{task:t,element:e}),0===r(this,ge).length&&p(this,be,Te).call(this,'show')})),!0}return!1}getTasks(t){let e=r(this,ge);return t?('number'==typeof t&&(t=[t]),e.filter((e=>{if(t.indexOf(e.status)>-1)return e}))):e}findTask(t){const e=this.getTasks().find((e=>e.id===t));return e instanceof J?e:null}get ownerElement(){return r(this,me).owner}get wrapperElement(){return r(this,me).wrapper}get wrapperTasksElement(){return r(this,me).wrapperTasks}get resolver(){return r(this,fe)}}function Te(t){const e=r(this,me).emptyText,s=function(t){return!1!==W(t)&&(0!==(''!==t.style?.opacity?parseFloat(t.style.opacity):1)&&'hidden'!==k(t,'visibility')&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length))}(e);if(W(e)){if(s&&'hide'===t||!1===s&&'show'===t)return de(e,this.options[t+'Animation']);e.style.display='show'===t?'block':'none'}return Promise.resolve(e)}function Ce(t,e='hide'){const s=this.options;return void 0!==s.tasksAnimation[e][t.status]?s.tasksAnimation[e][t.status]:s[e+'Animation']}function Ne(t){const e=this.options.taskClass;t.forEach(((s,a)=>{if(!(s instanceof J))if('object'==typeof s&&void 0!==typeof s.id){const n=s.id;delete s.id,t[a]=V(new e(n,this),s)}else Number.parseInt(s)>0?t[a]=new e(s,this):t.splice(a,1)}))}function xe(t,e=this.options.hideAnimation){return!1!==e?de(t,e).then((t=>(t.remove(),t))):Promise.resolve(!1)}$.classPrefix='qmc-',ye.TaskAbstract=J,ye.Button=Dt,ye.ButtonsGroup=Yt,ye.Icon=Rt,ye.Defaults=pe,ye.Events=mt,ye.Statuses=G}(document,window);
