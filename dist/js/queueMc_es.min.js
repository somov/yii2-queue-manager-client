/*!
 * @license
 * yii2-queue-manager-client 0.1.0 <https://github.com/somov/yii2-queue-manager-client#readme>
 * Copyright: somov.nn@gmail.com
 * Licensed under MIT
 */
!function(t,e){function s(t){return t&&'object'==typeof t&&'default'in t?t:{default:t}}var n=s(t),i=s(e);function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function r(t,e){return u(t,l(t,e,'get'))}function o(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError('attempted to set read only private field');e.value=s}}(t,l(t,e,'set'),s),s}function l(t,e,s){if(!e.has(t))throw new TypeError('attempted to '+s+' private field on non-instance');return e.get(t)}function h(t,e,s){return d(t,e),function(t,e){if(void 0===t)throw new TypeError('attempted to '+e+' private static field before its declaration')}(s,'get'),u(t,s)}function c(t,e,s){return d(t,e),s}function u(t,e){return e.get?e.get.call(t):e.value}function d(t,e){if(t!==e)throw new TypeError('Private static access of wrong provenance')}function p(t,e,s){if(!e.has(t))throw new TypeError('attempted to get private field on non-instance');return s}const f={prefixed:!0},m=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror','fullscreen'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror','-webkit-full-screen'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror','-moz-full-screen'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError','-ms-fullscreen']],g=m[0];let w;for(let t=0;t<m.length;t++)if(m[t][1]in n.default){w=m[t];break}if(w){for(let t=0;t<w.length;t++)f[g[t]]=w[t];f.prefixed=w[0]!==g[0]}function b(t,e){(t=>v(t)?Object.keys(t):[])(t).forEach((s=>e(t[s],s)))}function v(t){return!!t&&'object'==typeof t}function E(t,e){if(!t||!e)return'';if('function'==typeof i.default.getComputedStyle){const s=i.default.getComputedStyle(t);return s?s.getPropertyValue(e)||s[e]:''}return''}const y=i.default.navigator&&i.default.navigator.userAgent||'',k=/AppleWebKit\/([\d.]+)/i.exec(y);k&&parseFloat(k.pop()),/iPod/i.test(y),(()=>{const t=y.match(/OS (\d+)_/i);t&&t[1]&&t[1]})();const T=/Android/i.test(y);(()=>{const t=y.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const e=t[1]&&parseFloat(t[1]),s=t[2]&&parseFloat(t[2]);e&&s&&parseFloat(t[1]+'.'+t[2])})(),/Firefox/i.test(y);const C=/Edg/i.test(y),N=!C&&(/Chrome/i.test(y)||/CriOS/i.test(y));(()=>{const t=y.match(/(Chrome|CriOS)\/(\d+)/);t&&t[2]&&parseFloat(t[2])})(),(()=>{const t=/MSIE\s(\d+)\.\d/.exec(y);let e=t&&parseFloat(t[1]);!e&&/Trident\/7.0/i.test(y)&&/rv:11.0/.test(y)&&(e=11)})();const x=/Safari/i.test(y)&&!N&&!T&&!C;/Windows/i.test(y);const O=Boolean(n.default===i.default.document&&('ontouchstart'in i.default||i.default.navigator.maxTouchPoints||i.default.DocumentTouch&&i.default.document instanceof i.default.DocumentTouch));/iPad/i.test(y)||x&&O&&/iPhone/i.test(y);function M(t){return'string'==typeof t&&Boolean(t.trim())}function S(t){if(t.indexOf(' ')>=0)throw new Error('class has illegal whitespace characters')}function W(t){return v(t)&&1===t.nodeType}function A(t){return(e,s)=>{if(!M(e))return n.default[t](null);M(s)&&(s=n.default.querySelector(s));const i=W(s)?s:n.default;return i[t]&&i[t](e)}}function P(t='div',e={},s={},i){const a=n.default.createElement(t);return Object.getOwnPropertyNames(e).forEach((t=>{const s=e[t];-1!==t.indexOf('aria-')||'role'===t||'type'===t?a.setAttribute(t,s):'style'===t&&'object'==typeof s?Object.getOwnPropertyNames(s).forEach((t=>{a.style[t]=s[t]})):'textContent'===t?function(t,e){void 0===t.textContent?t.innerText=e:t.textContent=e}(a,s):a[t]===s&&'tabIndex'!==t||(a[t]=s)})),Object.getOwnPropertyNames(s).forEach((t=>{a.setAttribute(t,s[t])})),i&&function(t,e){(function(t){'function'==typeof t&&(t=t());return(Array.isArray(t)?t:[t]).map((t=>('function'==typeof t&&(t=t()),W(t)||function(t){return v(t)&&3===t.nodeType}(t)?t:'string'==typeof t&&/\S/.test(t)?n.default.createTextNode(t):void 0))).filter((t=>t))})(e).forEach((e=>t.appendChild(e)))}(a,i),a}function L(t,e){return S(e),t.classList?t.classList.contains(e):(s=e,new RegExp('(^|\\s)'+s+'($|\\s)')).test(t.className);var s}function _(t,e){return t.classList?t.classList.add(e):L(t,e)||(t.className=(t.className+' '+e).trim()),t}function I(t,e){return t.classList?t.classList.remove(e):(S(e),t.className=t.className.split(/\s+/).filter((t=>t!==e)).join(' ')),t}function R(t,e){t.removeAttribute(e)}function F(t,e,s,n=(t=>t.startsWith(s)?t:'')){let i='';t.classList.forEach((t=>{0===i.length&&(i=n(t))})),i!==e&&(i.length>0&&I(t,i),_(t,e))}var z;/iPhone/i.test(y),(z=Element.prototype).matches=z.matches||z.mozMatchesSelector||z.msMatchesSelector||z.oMatchesSelector||z.webkitMatchesSelector,z.closest=z.closest||function(t){return this?this.matches(t)?this:this.parentElement?this.parentElement.closest(t):null:null};const j=A('querySelector'),D=A('querySelectorAll');class q{static removeOptionsPtoperty(t,e,s=Element){if(e[t]instanceof s==!1)throw Error('Invalid call. Property '+t+' is not valid');{const s=e[t];return delete e[t],s}}createEl(t='div',e={},s={},n){if(void 0!==e.className){const t=new Set;('string'==typeof e.className?e.className.split(' '):e.className).forEach((e=>t.add(e)));let s='';for(let e of t)s+=' '+q.getClassName(e);e.className=s.trim()}return P(t,e,s,n)}static _normalizePrefix(t){return t.replace(new RegExp('\\.','g'),'$&'+q.classPrefix)}$(t,e){return t=q._normalizePrefix(t),j(t,e)}$$(t,e){return t=q._normalizePrefix(t),D(t,e)}}Object.assign(q,{classPrefix:null,getClassName:function(t){return null===this.classPrefix||t.startsWith(this.classPrefix)?t:this.classPrefix+t}});var $,B=(((t,e)=>{var s;s=t=>{t.version='1.2.0';var e=(()=>{for(var t=0,e=new Array(256),s=0;256!=s;++s)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=s)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[s]=t;return'undefined'!=typeof Int32Array?new Int32Array(e):e})();t.table=e,t.bstr=(t,s)=>{for(var n=-1^s,i=t.length-1,a=0;a<i;)n=(n=n>>>8^e[255&(n^t.charCodeAt(a++))])>>>8^e[255&(n^t.charCodeAt(a++))];return a===i&&(n=n>>>8^e[255&(n^t.charCodeAt(a))]),-1^n},t.buf=(t,s)=>{if(t.length>1e4)return((t,s)=>{for(var n=-1^s,i=t.length-7,a=0;a<i;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])];for(;a<i+7;)n=n>>>8^e[255&(n^t[a++])];return-1^n})(t,s);for(var n=-1^s,i=t.length-3,a=0;a<i;)n=(n=(n=(n=n>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])])>>>8^e[255&(n^t[a++])];for(;a<i+3;)n=n>>>8^e[255&(n^t[a++])];return-1^n},t.str=(t,s)=>{for(var n,i,a=-1^s,r=0,o=t.length;r<o;)(n=t.charCodeAt(r++))<128?a=a>>>8^e[255&(a^n)]:n<2048?a=(a=a>>>8^e[255&(a^(192|n>>6&31))])>>>8^e[255&(a^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),i=1023&t.charCodeAt(r++),a=(a=(a=(a=a>>>8^e[255&(a^(240|n>>8&7))])>>>8^e[255&(a^(128|n>>2&63))])>>>8^e[255&(a^(128|i>>6&15|(3&n)<<4))])>>>8^e[255&(a^(128|63&i))]):a=(a=(a=a>>>8^e[255&(a^(224|n>>12&15))])>>>8^e[255&(a^(128|n>>6&63))])>>>8^e[255&(a^(128|63&n))];return-1^a}},'undefined'==typeof DO_NOT_EXPORT_CRC?s(e):s({})})($={exports:{}},$.exports),$.exports);function H(t){return t&&'object'==typeof t&&!Array.isArray(t)}function X(t,...e){if(!e.length)return t;const s=e.shift();if(H(t)&&H(s))for(const e in s)H(s[e])?(t[e]||Object.assign(t,{[e]:{}}),X(t[e],s[e])):Object.assign(t,{[e]:s[e]});return X(t,...e)}const V='__EMPTY__',G={method:'post',delayTime:1e3};var U=new WeakMap,Y=new WeakMap,K=new WeakMap,J=new WeakSet,Q=new WeakSet,Z=new WeakSet;class tt{constructor(t){Z.add(this),Q.add(this),J.add(this),U.set(this,{writable:!0,value:[]}),Y.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:-1}),o(this,Y,X({},G,t))}resolve(t,e){if(!1===this.isRunning){const s=p(this,Z,it).call(this);o(this,K,0),s.forEach((e=>t(e))),p(this,J,et).call(this,0).catch((t=>{})).then((()=>{const t=r(this,K);return s.forEach((s=>e(s,t))),o(this,K,-1),t}))}}get tasks(){let t=[];return r(this,U).forEach((e=>{e.getTasks().forEach((e=>{!1===e.common&&t.push(e)}))})),t}get tasksId(){return this.tasks.map((t=>t.id)).filter(((t,e,s)=>s.indexOf(t===e)))}findTask(t){const e=this.tasks.find((e=>e.id===t));return e||!1}get options(){return r(this,Y)}get isRunning(){return r(this,K)>-1}static factory(t){const e=t.options.resolver,s=B.str(e.url),n=h(tt,tt,at),i=h(tt,tt,rt),a=n[s]=n[s]instanceof tt?n[s]:new tt(e),r=p(a,Z,it).call(a);return-1===r.indexOf(t)&&(r.push(t),t.options.common&&i.push(t),t.ownerElement.addEventListener(Ee.Events.destroy,(t=>{let e=r.indexOf(t.manager);e>-1&&(i.forEach((t=>{t.getTasks().filter((t=>t.initiatorManager===r[e])).forEach((e=>{t.removeTask(e)}))})),r.splice(e,1)),e=i.findIndex((e=>e===t.manager)),e>-1&&i.splice(e,1)}))),a}}function et(t=this.options.delayTime){return p(this,Q,nt).call(this,t).then((t=>{if(!1===t.ok)throw Error(`${t.status} - ${t.statusText}' `);return t.json().then((t=>(t.length>0&&(t.forEach((t=>{const e=this.findTask(t.id);e&&e.manager._updateTask(e,t)})),c(tt,tt,st).call(tt,t,this)),p(this,J,et).call(this))))}))}function st(t,e){h(tt,tt,rt).forEach((s=>{t.forEach((t=>{let n=s.findTask(t.id);null===n&&(t.common=!0,t.title='',s.addTasks([t],!1),n=s.findTask(t.id),n.initiatorManager=e.tasks.find((e=>e.id===t.id))?.manager),n.common&&s._updateTask(n,t)}))}))}function nt(t){return new Promise(((e,s)=>{const n=this.tasksId;0===n.length?s(V):setTimeout((()=>e(n)),t)})).then((t=>(o(this,K,+r(this,K)+1),fetch(this.options.url,X({},this.options,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:encodeURI(t.map((t=>`t[]=${t}`)).join('&'))})))))}function it(t=!1){return!1===t?r(this,U):r(this,U).filter((t=>!0===t.options.common))}var at={writable:!0,value:[]},rt={writable:!0,value:[]};const ot={ready:'qmc:manager:ready',destroy:'qmc:manager:destroy',statusChange:'qmc:manager:statusChange',fetchStart:'qmc:resolver:start',fetchEnd:'qmc:resolver:end',toString:function(){const t=[];return b(this,(e=>{t.push(e)})),t.join(' ')}},lt={INIT:-1,WAIT:0,EXEC:1,DONE:2,ERROR:3,DELETED:99};lt.SET_VISIBLE=[lt.WAIT,lt.EXEC,lt.ERROR,lt.DONE],lt.SET_COMPLETE=[lt.DONE,lt.ERROR,lt.DELETED],lt.is=(t,e)=>t.indexOf(e)>-1;var ht=new WeakMap;class ct extends CustomEvent{constructor(t,e,s){super(e,s),ht.set(this,{writable:!0,value:null}),o(this,ht,t)}get manager(){return r(this,ht)}}var ut=new WeakMap,dt=new WeakMap,pt=new WeakSet;class ft extends q{constructor(t,e){super(),pt.add(this),ut.set(this,{writable:!0,value:null}),a(this,'id',void 0),a(this,'common',!1),a(this,'initiatorManager',void 0),a(this,'progress',0),a(this,'text',''),a(this,'title',''),a(this,'status',lt.INIT),dt.set(this,{writable:!0,value:null}),this.id=parseInt(t),o(this,ut,e)}_renderChild(t){}_buildCssClass(){return['task-item']}cssClassSwitch(){const t=p(this,pt,mt).call(this);let e,s;if('object'==typeof this.manager.options.theme){let n=this.manager.options.theme[this.status]||!1;n&&(e=ft.getClassName('theme-'+n),s=ft.getClassName('theme'),F(t,e,s))}e=h(ft,ft,gt).call(ft)[this.status],s=ft.getClassName('status'),F(t,e,s)}refresh(t,e=null){p(this,pt,mt).call(this),e&&this._refreshElements(e,t)}getProgressTotal(t='progress'){let e=0;return this.hasOwnProperty(t)&&(e=this[t],'object'==typeof e&&e.length&&(e=Math.round(e.reduce(((t,e)=>t+e))/e.length,0))),e}_refreshElements(t,e){const s=this.options.parts;Object.keys(t).forEach((n=>{let i=s[n],a='refreshBasicProperty';if('string'==typeof i){if(i.indexOf('.')>0){let[t,e]=i.split('.');a=t+e[0].toUpperCase()+e.slice(1),i=e}const s=void 0!==this[i]?this[i]:null;s!==(void 0!==e[i]?e[i]:null)&&(a='_'+a,'function'==typeof this[a]&&this[a].call(this,t[n],s,i))}}))}_refreshBasicProperty(t,e,s){if(Array.isArray(e)){const n=ft.getClassName('list-'+s);let i=j('ul.'+n,t);null===i&&(i=this.createEl('ul',{className:n}),t.append(i)),e.forEach(((t,e)=>{let s=j(`li:nth-child(${e+1})`,i);null===s?i.append(P('li',{},{},t)):s.innerText!==t&&(s.innerText=t)}))}else t.innerHTML=e}get manager(){return r(this,ut)}get element(){return r(this,dt)}get options(){return this.manager.options.taskOptions}get statusText(){return this.manager.options.statusText[this.status]||''}getTitle(){return''}toString(){return this.statusText+' '+this.getTitle()}}function mt(){if(r(this,dt))return r(this,dt);const t=o(this,dt,this.createEl('div',{className:'wrapper'},{'data-task-id':this.id})),e=this.createEl('div',{className:this._buildCssClass()});return this._renderChild(e),t.append(e),t}var gt={writable:!0,value:function(){if(this._cssList)return this._cssList;this._cssList={};for(let t in lt)'number'==typeof lt[t]&&(this._cssList[lt[t]]=q.getClassName('status-'+t.toLowerCase()));return this._cssList}};let wt,bt=3;i.default.WeakMap||(wt=class{constructor(){this.vdata='vdata'+Math.floor(i.default.performance&&i.default.performance.now()||Date.now()),this.data={}}set(t,e){const s=t[this.vdata]||bt++;return t[this.vdata]||(t[this.vdata]=s),this.data[s]=e,this}get(t){const e=t[this.vdata];if(e)return this.data[e]}has(t){return t[this.vdata]in this.data}delete(t){const e=t[this.vdata];e&&(delete this.data[e],delete t[this.vdata])}});var vt=i.default.WeakMap?new WeakMap:new wt,Et=new WeakMap,yt=new WeakMap,kt=new WeakMap,Tt=new WeakSet;class Ct extends q{constructor(...t){super(),Tt.add(this),a(this,'label',''),a(this,'className',Ct.getClassName('progress')),a(this,'size',null),Et.set(this,{writable:!0,value:[]}),a(this,'barOptions',{}),yt.set(this,{writable:!0,value:null}),kt.set(this,{writable:!0,value:null}),a(this,'isShowGradient',!0),X(this,...t)}render(){let t=r(this,kt);if(t instanceof HTMLElement)return t;let e=this.className;return this.size&&(e+=' '+Ct.getClassName('size-'+this.size)),!1===this.isShowGradient&&(e+=' '+Ct.getClassName('no-gradient')),t=P('div',{className:e},{},P('div',{className:Ct.getClassName('progress-items')})),o(this,kt,t)}setProgress(t){const e=r(this,Et),s=r(this,kt);t.length,(t='number'==typeof t?[t]:t).forEach(((t,n)=>{e[n]instanceof Mt?e[n].progress=t:(e[n]=new Mt(this.barOptions,{progress:t}),s.querySelector('.'+Ct.getClassName('progress-items')).append(P('div',{className:Ct.getClassName('progress-item')},{},e[n].render())))}));const n=Ct.getClassName('more-than-three');!1===L(s,n)&&t.length>3&&_(s,n)}setLabel(t){t&&(p(this,Tt,Nt).call(this).innerHTML=t)}}function Nt(){let t=r(this,yt);return t instanceof Element||(o(this,yt,t=P('span',{className:Ct.getClassName('progress-label')},{})),r(this,kt).append(t)),t}a(Ct,'$classPrefix',null);var xt=new WeakMap,Ot=new WeakMap;class Mt{constructor(...t){xt.set(this,{writable:!0,value:!1}),a(this,'className','progress-bar'),Ot.set(this,{writable:!0,value:0}),a(this,'labelText',''),a(this,'min',0),a(this,'max',100),X(this,...t)}render(){let t=r(this,xt);if(t)return t;let e=[];return!1===this.labelText?e.push(P('span',{className:'sr-only',css:{width:0}},{},this.label)):e=this.label,o(this,xt,t=P('div',{className:Ct.getClassName(this.className)},{role:'progressbar','aria-valuenow':this.progress,'aria-valuemin':this.min,'aria-valuemax':this.max},e)),t}get label(){const t=this.labelText?this.labelText:'';return`${this.progress}% ${t}`}get progress(){return r(this,Ot)}set progress(t){o(this,Ot,t);const e=this.render();e.setAttribute('aria-valuenow',t),e.childNodes.length>0?e.childNodes[0].textContent=this.label:e.textContent=this.label,e.style.width=`${t}%`}}var St=new WeakMap,Wt=new WeakMap,At=new WeakMap,Pt=new WeakSet;class Lt extends q{constructor(t=!1,e=!1){super(),Pt.add(this),St.set(this,{writable:!0,value:void 0}),Wt.set(this,{writable:!0,value:!1}),At.set(this,{writable:!0,value:!1}),o(this,Wt,t),o(this,At,e)}render(){let t=r(this,St);return t instanceof Element?t:o(this,St,this.createEl('span',{className:p(this,Pt,_t).call(this)},{},P('span',{},{},['s1','s2','s3'].map((t=>P('span',{className:t}))))))}set icon(t){if(t){let e=r(this,Wt);if(e!==t){const s=r(this,St);e&&I(s,e),_(s,t),o(this,Wt,t)}}}set size(t){if(t){t=Lt.getClassName('size-'+t);const e=r(this,At);if(e!==t){const s=r(this,St);e&&I(s,e),_(s,t),o(this,At,t)}}}set color(t){D('span[class^=s]',r(this,St)).forEach((e=>{e.style.backgroundColor=t}))}}function _t(){let t='icon-t',e=[];return r(this,Wt)&&(t+=' '+r(this,Wt)),e.push(t),r(this,At)&&e.push('size-'+r(this,At)),e}const It={tagName:'button',handler:null,handlerTimoutDelay:500,label:!1,hiddenLabel:'',disabled:!1,size:null,iconName:null,iconHoverName:null,iconSize:null,animatedClick:!0,data:{}};var Rt=new WeakMap,Ft=new WeakMap,zt=new WeakMap,jt=new WeakSet;class Dt extends q{constructor(t){super(),jt.add(this),Rt.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:It}),zt.set(this,{writable:!0,value:null}),t&&'object'==typeof t&&o(this,Ft,X({},It,t))}render(){let t=r(this,Rt);if(t instanceof Element)return t;const e=this.options,s=[];if(e.iconName){const t=this.icon;s.push(t.render()),t.icon=e.iconName,t.size=e.iconSize}if(e.label&&s.push(P('p',{},{},e.label)),e.hiddenLabel&&s.push(this.createEl('p',{className:'button-hidden'},{},e.hiddenLabel)),e.animatedClick){const t=P('p',{className:'drop'});t.addEventListener('animationend',(function(){I(this,'animate')})),s.push(t)}return t=o(this,Rt,this.createEl(e.tagName,{className:c(Dt,Dt,qt).call(Dt,e)},{},s)),this.disabled=e.disabled,p(this,jt,$t).call(this,t,e),t}set disabled(t){const e=this.options;t!==e.disabled&&('button'===e.tagName.toLowerCase()?r(this,Rt).disabled=t:function(t,e,s){const n=L(t,e);if('function'==typeof s&&(s=s(t,e)),'boolean'!=typeof s&&(s=!n),s!==n)s?_(t,e):I(t,e)}(r(this,Rt),'disabled'),e.disabled=t)}get options(){return r(this,Ft)}get element(){return this.render()}get icon(){let t=r(this,zt);return t instanceof Lt?t:o(this,zt,new Lt)}}function qt(t){let e=['button'];return t.size&&e.push('size-'+t.size),t.hiddenLabel&&e.push('has-hidden'),e}function $t(t,e){t.addEventListener('click',(s=>{if(e.disabled)return s.stopImmediatePropagation(),!1;e.animatedClick&&c(Dt,Dt,Bt).call(Dt,t)})),'function'==typeof e.handler&&(e.handlerTimoutDelay>0?t.addEventListener('click',(t=>{setTimeout((()=>e.handler.call(this,t)),e.handlerTimoutDelay)})):t.addEventListener('click',e.handler.bind(this))),e.iconHoverName&&(t.addEventListener('mouseenter',(()=>{!1===e.disabled&&(this.icon.icon=e.iconHoverName)})),t.addEventListener('mouseleave',(()=>{this.icon.icon=e.iconName})))}function Bt(t){const e=j('.drop',t);if(e){const s=function(t){if(t&&t.getBoundingClientRect&&t.parentNode){const e=t.getBoundingClientRect(),s={};return['bottom','height','left','right','top','width'].forEach((t=>{void 0!==e[t]&&(s[t]=e[t])})),s.height||(s.height=parseFloat(E(t,'height'))),s.width||(s.width=parseFloat(E(t,'width'))),s}}(t),n=event.pageX-s.width/2-s.left-window.scrollX,i=event.pageY-s.height/2-s.top-window.scrollY;e.style.top=i+'px',e.style.left=n+'px',_(e,'animate')}}Dt.Defaults=It;const Ht={buttons:[],arrange:!1,scaled:!1,selectable:!1,selectIcon:null};var Xt=new WeakMap,Vt=new WeakMap,Gt=new WeakSet;class Ut extends q{constructor(t){super(),Gt.add(this),a(this,'buttons',null),Xt.set(this,{writable:!0,value:Ht}),Vt.set(this,{writable:!0,value:void 0});const e=q.removeOptionsPtoperty('buttons',t,Array);o(this,Xt,X({},Ht,t)),this.buttons=e.map((t=>new Dt(t)))}render(){let t=r(this,Vt);return t instanceof Element||(o(this,Vt,t=this.createEl('div',{className:c(Ut,Ut,Yt).call(Ut,this.options)},{},this.buttons.map((t=>t.render())))),this.options.selectable&&p(this,Gt,Kt).call(this,t)),t}get options(){return r(this,Xt)}set arrange(t){const e=Ut.getClassName('arrange');let s=r(this,Vt),n=r(this,Xt);s&&(t?!1===L(s,e)&&_(s,e):I(s,e)),n.arrange=t}set selected(t){const e=Ut.getClassName('selected'),s=this.options;'number'==typeof t&&(t=this.buttons[t]),t instanceof Dt&&(this.buttons.forEach((t=>{R(t.element,'data-group-selected'),I(t.element,e)})),_(t.element,e),s.selectIcon&&(t.icon.icon=s.selectIcon,t.options.iconName=s.selectIcon))}}function Yt(t){let e=['button-group'];return t.arrange&&e.push('arrange'),t.scaled&&e.push('scaled'),e}function Kt(t){t.addEventListener('click',(t=>{const e=t.target.closest('.'+Ut.getClassName('button'));this.selected=this.buttons.find((t=>t.element===e))})),t.addEventListener('mouseenter',(t=>{this.$$('.button.selected',t.target).forEach((t=>{!function(t,e,s){t.setAttribute(e,s)}(t,'data-group-selected',!0),I(t,Ut.getClassName('selected'))}))})),t.addEventListener('mouseleave',(t=>{this.$$('.button[data-group-selected]',t.target).forEach((t=>{R(t,'data-group-selected'),_(t,Ut.getClassName('selected'))}))}))}var Jt=new WeakMap,Qt=new WeakMap,Zt=new WeakMap,te=new WeakMap,ee=new WeakMap;class se extends q{constructor(t,e,s){super(),Jt.set(this,{writable:!0,value:[]}),a(this,'map',{icons:[],actions:[]}),Qt.set(this,{writable:!0,value:void 0}),Zt.set(this,{writable:!0,value:null}),te.set(this,{writable:!0,value:null}),ee.set(this,{writable:!0,value:null}),o(this,Qt,t),this.map.icons=e,this.map.actions=s,o(this,Zt,new Lt('none','big')),o(this,te,this.createEl('span',{className:'status-text'})),s.forEach((e=>{X(e,{data:{task:t}})})),o(this,ee,new Ut({buttons:s,arrange:!1,scaled:!0}))}render(){let t=r(this,Jt);return t.length>0||(t.push(r(this,Zt).render()),t.push(r(this,te)),t.push(r(this,ee).render())),t}refresh(t){r(this,te).innerHTML=r(this,Qt).statusText,r(this,Zt).icon=this.map.icons[t],r(this,ee).buttons.forEach((e=>{let s=e.options?.enabledWithStatus;if('function'==typeof s&&(s=s.call(e,t)),Array.isArray(s)){if(0===e.options.enabledWithStatus.length)return;e.disabled=-1===e.options.enabledWithStatus.indexOf(t)}else'boolean'==typeof s&&(e.disabled=s)}))}}const ne={iconPlacement:'default',parts:{status:'refresh.status',title:'title',text:'text',error:'errors','progress-wrapper':'refresh.progress'},progress:{label:'',size:'',barOptions:{labelText:!1}},actions:[]},ie={};ie[lt.WAIT]='clock',ie[lt.EXEC]='play',ie[lt.ERROR]='warning',ie[lt.DONE]='checked';var ae=new WeakMap;class re extends ft{constructor(...t){super(...t),ae.set(this,{writable:!0,value:{}})}_renderChild(t){const e=r(this,ae),s=this.options,n=t.appendChild(this.createEl('div',{className:'detail'})),i=t.appendChild(this.createEl('div',{className:'status-wrapper'}));Object.keys(s.parts).forEach((t=>{let a=n,r=null;if('progress-wrapper'===t?s.progress?r=new Ct(s.progress):delete s['progress-wrapper']:'status'===t&&(a=i,r=new se(this,ie,s.actions)),e[t]=a.appendChild(this.createEl('div',{className:t},{})),r&&'function'==typeof r?.render){let s=r.render();s instanceof Element&&(s=[s]),s.forEach((s=>e[t].append(s))),c(re,re,oe).call(re,e[t],r)}}))}refresh(t){super.refresh(t,r(this,ae))}_buildCssClass(){const t=super._buildCssClass();return this.options.iconPlacement!==ne.iconPlacement&&t.push('task-item-'+this.options.iconPlacement),t}_refreshProgress(t,e){const s=c(re,re,le).call(re,t);s instanceof Ct&&(s.setLabel(this.getProgressTotal()+'%'),s.setProgress(e))}_refreshStatus(t,e){c(re,re,le).call(re,t).refresh(e)}getTitle(){const t=this.options.parts.title;return t?this[t]??'':''}}function oe(t,e){vt.has(t)||vt.set(t,{});vt.get(t).componet=e}function le(t){if(vt.has(t)){const e=vt.get(t);if(void 0!==e.componet)return e.componet}return null}re.Defualts=ne;const he={linear:t=>t,quad:t=>Math.pow(t,2),circ:t=>1-Math.sin(Math.acos(t)),back:(t=1.5,e)=>Math.pow(e,2)*((t+1)*e-t)},ce={fadeOut:function(t){this.style.opacity=1-Math.round(100*t)/100},fadeIn:function(t){'none'===this.style.display&&(this.style.display=null),this.style.opacity=Math.round(100*t)/100}};function ue(t,e={name:'fadeOut',timing:he.linear,duration:500,delay:0}){let s=Object.assign({},e);if('function'==typeof s.draw)s.draw.bind(t);else{if('string'!=typeof s.name||'function'!=typeof ce[s.name])throw new Error('Unknown animation ');s.draw=ce[s.name].bind(t)}return'number'!=typeof s.delay&&(s.delay=0),s.timing='string'==typeof s.timing&&'function'==typeof he[s.timing]?he[s.timing]:he.linear,new Promise((e=>{setTimeout((()=>function({timing:t,draw:e,duration:s},n){let i=performance.now();requestAnimationFrame((function a(r){let o=(r-i)/s;o>1&&(o=1);let l=t(o);e(l),o<1?requestAnimationFrame(a):n&&n()}))}(s,(()=>{e(t)}))),s.delay)}))}const de={common:!1,title:'<h3>Backgrounds tasks</h3>',theme:{'-1':'default'},renderOnEmpty:!0,taskClass:re,emptyText:'Tasks not provided yet',taskOptions:{},tasks:[],statusText:{},hideAnimation:{name:'fadeOut',duration:1e3,timing:'linear',delay:0},showAnimation:{name:'fadeIn',duration:1e3,timing:'linear',delay:0},tasksAnimation:{hide:{},show:{}},resolver:{url:'queue-reader'}};de.tasksAnimation.hide[lt.DONE]=X({},de.hideAnimation,{delay:5e3}),de.tasksAnimation.hide[lt.ERROR]=X({},de.hideAnimation,{delay:2e4}),de.tasksAnimation.show[lt.EXEC]=X({},de.showAnimation,{duration:500}),de.tasksAnimation.show[lt.WAIT]=X({},de.showAnimation,{duration:500}),de.tasksAnimation.hide[lt.ERROR]=!1,de.statusText[lt.DONE]='Complete',de.statusText[lt.ERROR]='Complete with errors',de.statusText[lt.EXEC]='Processing',de.statusText[lt.WAIT]='Awaiting';var pe=new WeakMap,fe=new WeakMap,me=new WeakMap,ge=new WeakMap,we=new WeakSet,be=new WeakSet,ve=new WeakSet;class Ee extends q{constructor(t){super(),ve.add(this),be.add(this),we.add(this),pe.set(this,{writable:!0,value:null}),fe.set(this,{writable:!0,value:{owner:null,wrapper:null,wrapperTasks:null,emptyText:null}}),me.set(this,{writable:!0,value:[]}),ge.set(this,{writable:!0,value:{}}),r(this,fe).owner=q.removeOptionsPtoperty('element',t);let e=X({},Ee.Defaults,t);o(this,ge,X({},{taskOptions:e.taskClass.Defualts},e)),o(this,pe,tt.factory(this)),this.render(),t.tasks&&void 0!==t.tasks.length&&this.addTasks(t.tasks),setTimeout((()=>{0===this.getTasks().length&&p(this,we,ye).call(this,'show')}),200),this.trigger(ot.ready,{bubbles:!0})}destroy(){this.trigger(ot.destroy,{bubbles:!0}),o(this,me,[]),this.ownerElement.remove()}get options(){return r(this,ge)}trigger(t,e={},s){if('object'==typeof s){e.detail={};for(const[t,n]of Object.entries(s))e.detail[t]=n}return this.ownerElement.dispatchEvent(new ct(this,t,e))}render(){const t=this.getTasks(lt.SET_VISIBLE);if(0===t.length&&!1===this.options.renderOnEmpty)return!1;const e=r(this,fe);if(null===e.wrapper){const t=this.options;e.wrapper=e.owner.appendChild(this.createEl('div',{className:'wrapper'})),0===e.wrapper.childNodes.length&&(t.title&&this.options.title.length>0&&e.wrapper.appendChild(this.createEl('div',{innerHTML:this.options.title,className:'title'})),e.wrapperTasks=e.wrapper.appendChild(this.createEl('div',{className:'tasks'})),t.emptyText.length>0&&(e.emptyText=e.wrapper.appendChild(e.emptyText=this.createEl('div',{className:'empty-wrapper',style:{display:'none'}},{},[this.createEl('span',{className:'empty-text',textContent:t.emptyText})])))),'string'==typeof t.theme&&F(e.wrapper,Ee.getClassName('theme-'+t.theme),Ee.getClassName('theme'))}return t.forEach((t=>t.refresh())),!0}addTasks(t,e=!0){t&&t.length>0&&(o(this,me,r(this,me).concat(t)),p(this,we,ye).call(this,'hide').then((()=>{e&&this.resolver.resolve((t=>{t.trigger(ot.fetchStart,{bubbles:!0})}),((t,e)=>{t.trigger(ot.fetchEnd,{bubbles:!0},{requests:e})}))})))}_updateTask(t,e){if(t.progress!==e.progress||t.status!==e.status||t.text!==e.text||t.title!==e.title){const s=t.status!==e.status,n=X({},t);if((t=X(t,e)).refresh(n),s){if(t.cssClassSwitch(),lt.is([lt.EXEC],t.status),this.trigger(ot.statusChange,{bubbles:!0},{task:t,oldStatus:n.status}),lt.is(lt.SET_VISIBLE,t.status)&&null===t.element.parentNode){const e=t.element;e.style.display='none',this.wrapperTasksElement.append(e),ue(e,p(this,be,ke).call(this,t,'show'))}lt.is(lt.SET_COMPLETE,t.status)&&t.element.parentNode instanceof Element&&this.removeTask(t)}}}removeTask(t,e=null){let s=this.getTasks();if('number'==typeof t&&(t=s.find((e=>e.id===t))),t instanceof ft){const s=this.getTasks().findIndex((e=>e.id===t.id));if(s>-1)return r(this,me).splice(s,1),p(this,ve,Te).call(this,t.element,p(this,be,ke).call(this,t)).then((t=>{e&&e(t),0===r(this,me).length&&p(this,we,ye).call(this,'show')})),!0}return!1}getTasks(t){let e=r(this,me);const s=this.options.taskClass;return e.forEach(((t,n)=>{t instanceof ft||('object'==typeof t?e[n]=X(new s(null,this),t):Number.parseInt(t)>0&&(e[n]=new s(t,this)))})),t?('number'==typeof t&&(t=[t]),e.filter((e=>{if(t.indexOf(e.status)>-1)return e}))):e}findTask(t){const e=this.getTasks().find((e=>e.id===t));return e instanceof ft?e:null}get ownerElement(){return r(this,fe).owner}get wrapperElement(){return r(this,fe).wrapper}get wrapperTasksElement(){return r(this,fe).wrapperTasks}get resolver(){return r(this,pe)}}function ye(t){const e=r(this,fe).emptyText,s=function(t){return!1!==W(t)&&(0!==(''!==t.style?.opacity?parseFloat(t.style.opacity):1)&&'hidden'!==E(t,'visibility')&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length))}(e);return W(e)&&(s&&'hide'===t||!1===s&&'show'===t)?ue(e,this.options[t+'Animation']):Promise.resolve(e)}function ke(t,e='hide'){const s=this.options;return void 0!==s.tasksAnimation[e][t.status]?s.tasksAnimation[e][t.status]:s[e+'Animation']}function Te(t,e=this.options.hideAnimation){return!1!==e?ue(t,e).then((t=>(t.remove(),t))):Promise.resolve(!1)}q.classPrefix='qmc-',Ee.TaskAbstract=ft,Ee.Button=Dt,Ee.ButtonsGroup=Ut,Ee.Icon=Lt,Ee.Defaults=de,Ee.Events=ot,Ee.Statuses=lt}(document,window);
