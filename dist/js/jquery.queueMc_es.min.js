/*!
 * @license
 * yii2-queue-manager-client 0.1.0 <https://github.com/somov/yii2-queue-manager-client#readme>
 * Copyright: somov.nn@gmail.com
 * Licensed under MIT
 */
!function(t,e,s){function n(t){return t&&'object'==typeof t&&'default'in t?t:{default:t}}var a=n(t),i=n(e),r=n(s);function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function l(t,e){return p(t,h(t,e,'get'))}function c(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError('attempted to set read only private field');e.value=s}}(t,h(t,e,'set'),s),s}function h(t,e,s){if(!e.has(t))throw new TypeError('attempted to '+s+' private field on non-instance');return e.get(t)}function u(t,e,s){return f(t,e),function(t,e){if(void 0===t)throw new TypeError('attempted to '+e+' private static field before its declaration')}(s,'get'),p(t,s)}function d(t,e,s){return f(t,e),s}function p(t,e){return e.get?e.get.call(t):e.value}function f(t,e){if(t!==e)throw new TypeError('Private static access of wrong provenance')}function m(t,e,s){if(!e.has(t))throw new TypeError('attempted to get private field on non-instance');return s}const g={prefixed:!0},w=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror','fullscreen'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror','-webkit-full-screen'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror','-moz-full-screen'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError','-ms-fullscreen']],b=w[0];let v;for(let t=0;t<w.length;t++)if(w[t][1]in i.default){v=w[t];break}if(v){for(let t=0;t<v.length;t++)g[b[t]]=v[t];g.prefixed=v[0]!==b[0]}const E=Object.prototype.toString;function y(t,e){(t=>k(t)?Object.keys(t):[])(t).forEach((s=>e(t[s],s)))}function k(t){return!!t&&'object'==typeof t}function T(t,e){if(!t||!e)return'';if('function'==typeof r.default.getComputedStyle){const s=r.default.getComputedStyle(t);return s?s.getPropertyValue(e)||s[e]:''}return''}const C=r.default.navigator&&r.default.navigator.userAgent||'',N=/AppleWebKit\/([\d.]+)/i.exec(C);N&&parseFloat(N.pop()),/iPod/i.test(C),(()=>{const t=C.match(/OS (\d+)_/i);t&&t[1]&&t[1]})();const x=/Android/i.test(C);(()=>{const t=C.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const e=t[1]&&parseFloat(t[1]),s=t[2]&&parseFloat(t[2]);e&&s&&parseFloat(t[1]+'.'+t[2])})(),/Firefox/i.test(C);const M=/Edg/i.test(C),O=!M&&(/Chrome/i.test(C)||/CriOS/i.test(C));(()=>{const t=C.match(/(Chrome|CriOS)\/(\d+)/);t&&t[2]&&parseFloat(t[2])})(),(()=>{const t=/MSIE\s(\d+)\.\d/.exec(C);let e=t&&parseFloat(t[1]);!e&&/Trident\/7.0/i.test(C)&&/rv:11.0/.test(C)&&(e=11)})();const S=/Safari/i.test(C)&&!O&&!x&&!M;/Windows/i.test(C);const A=Boolean(i.default===r.default.document&&('ontouchstart'in r.default||r.default.navigator.maxTouchPoints||r.default.DocumentTouch&&r.default.document instanceof r.default.DocumentTouch));/iPad/i.test(C)||S&&A&&/iPhone/i.test(C);function W(t){return'string'==typeof t&&Boolean(t.trim())}function P(t){if(t.indexOf(' ')>=0)throw new Error('class has illegal whitespace characters')}function L(t){return k(t)&&1===t.nodeType}function _(t){return(e,s)=>{if(!W(e))return i.default[t](null);W(s)&&(s=i.default.querySelector(s));const n=L(s)?s:i.default;return n[t]&&n[t](e)}}function I(t='div',e={},s={},n){const a=i.default.createElement(t);return Object.getOwnPropertyNames(e).forEach((t=>{const s=e[t];-1!==t.indexOf('aria-')||'role'===t||'type'===t?a.setAttribute(t,s):'style'===t&&'object'==typeof s?Object.getOwnPropertyNames(s).forEach((t=>{a.style[t]=s[t]})):'textContent'===t?function(t,e){void 0===t.textContent?t.innerText=e:t.textContent=e}(a,s):a[t]===s&&'tabIndex'!==t||(a[t]=s)})),Object.getOwnPropertyNames(s).forEach((t=>{a.setAttribute(t,s[t])})),n&&function(t,e){(function(t){'function'==typeof t&&(t=t());return(Array.isArray(t)?t:[t]).map((t=>('function'==typeof t&&(t=t()),L(t)||function(t){return k(t)&&3===t.nodeType}(t)?t:'string'==typeof t&&/\S/.test(t)?i.default.createTextNode(t):void 0))).filter((t=>t))})(e).forEach((e=>t.appendChild(e)))}(a,n),a}function R(t,e){return P(e),t.classList?t.classList.contains(e):(s=e,new RegExp('(^|\\s)'+s+'($|\\s)')).test(t.className);var s}function j(t,e){return t.classList?t.classList.add(e):R(t,e)||(t.className=(t.className+' '+e).trim()),t}function q(t,e){return t.classList?t.classList.remove(e):(P(e),t.className=t.className.split(/\s+/).filter((t=>t!==e)).join(' ')),t}function F(t,e){t.removeAttribute(e)}function z(t,e,s,n=(t=>t.startsWith(s)?t:'')){let a='';t.classList.forEach((t=>{0===a.length&&(a=n(t))})),a!==e&&(a.length>0&&q(t,a),j(t,e))}var D;/iPhone/i.test(C),(D=Element.prototype).matches=D.matches||D.mozMatchesSelector||D.msMatchesSelector||D.oMatchesSelector||D.webkitMatchesSelector,D.closest=D.closest||function(t){return this?this.matches(t)?this:this.parentElement?this.parentElement.closest(t):null:null};const $=_('querySelector'),B=_('querySelectorAll');class H{static removeOptionsPtoperty(t,e,s=Element){if(e[t]instanceof s==!1)throw Error('Invalid call. Property '+t+' is not valid');{const s=e[t];return delete e[t],s}}createEl(t='div',e={},s={},n){if(void 0!==e.className){const t=new Set;('string'==typeof e.className?e.className.split(' '):e.className).forEach((e=>t.add(e)));let s='';for(let e of t)s+=' '+H.getClassName(e);e.className=s.trim()}return I(t,e,s,n)}static _normalizePrefix(t){return t.replace(new RegExp('\\.','g'),'$&'+H.classPrefix)}$(t,e){return t=H._normalizePrefix(t),$(t,e)}$$(t,e){return t=H._normalizePrefix(t),B(t,e)}}Object.assign(H,{classPrefix:null,getClassName:function(t){return null===this.classPrefix||t.startsWith(this.classPrefix)?t:this.classPrefix+t}});var X,G=(((t,e)=>{var s;s=t=>{t.version='1.2.0';var e=(()=>{for(var t=0,e=new Array(256),s=0;256!=s;++s)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=s)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[s]=t;return'undefined'!=typeof Int32Array?new Int32Array(e):e})();t.table=e,t.bstr=(t,s)=>{for(var n=-1^s,a=t.length-1,i=0;i<a;)n=(n=n>>>8^e[255&(n^t.charCodeAt(i++))])>>>8^e[255&(n^t.charCodeAt(i++))];return i===a&&(n=n>>>8^e[255&(n^t.charCodeAt(i))]),-1^n},t.buf=(t,s)=>{if(t.length>1e4)return((t,s)=>{for(var n=-1^s,a=t.length-7,i=0;i<a;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])];for(;i<a+7;)n=n>>>8^e[255&(n^t[i++])];return-1^n})(t,s);for(var n=-1^s,a=t.length-3,i=0;i<a;)n=(n=(n=(n=n>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])];for(;i<a+3;)n=n>>>8^e[255&(n^t[i++])];return-1^n},t.str=(t,s)=>{for(var n,a,i=-1^s,r=0,o=t.length;r<o;)(n=t.charCodeAt(r++))<128?i=i>>>8^e[255&(i^n)]:n<2048?i=(i=i>>>8^e[255&(i^(192|n>>6&31))])>>>8^e[255&(i^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),a=1023&t.charCodeAt(r++),i=(i=(i=(i=i>>>8^e[255&(i^(240|n>>8&7))])>>>8^e[255&(i^(128|n>>2&63))])>>>8^e[255&(i^(128|a>>6&15|(3&n)<<4))])>>>8^e[255&(i^(128|63&a))]):i=(i=(i=i>>>8^e[255&(i^(224|n>>12&15))])>>>8^e[255&(i^(128|n>>6&63))])>>>8^e[255&(i^(128|63&n))];return-1^i}},'undefined'==typeof DO_NOT_EXPORT_CRC?s(e):s({})})(X={exports:{}},X.exports),X.exports);function V(t){return t&&'object'==typeof t&&!Array.isArray(t)}function U(t,...e){if(!e.length)return t;const s=e.shift();if(V(t)&&V(s))for(const e in s)V(s[e])?(t[e]||Object.assign(t,{[e]:{}}),U(t[e],s[e])):Object.assign(t,{[e]:s[e]});return U(t,...e)}const Y={INIT:-1,WAIT:0,EXEC:1,DONE:2,ERROR:3,DELETED:99};Y.SET_VISIBLE=[Y.WAIT,Y.EXEC,Y.ERROR,Y.DONE],Y.SET_COMPLETE=[Y.DONE,Y.ERROR,Y.DELETED],Y.is=(t,e)=>t.indexOf(e)>-1;var K=new WeakMap,Q=new WeakMap,J=new WeakSet;class Z extends H{constructor(t,e){super(),J.add(this),K.set(this,{writable:!0,value:null}),o(this,'id',void 0),o(this,'common',!1),o(this,'initiatorManager',void 0),o(this,'progress',0),o(this,'text',''),o(this,'title',''),o(this,'status',Y.INIT),Q.set(this,{writable:!0,value:null}),this.id=parseInt(t),c(this,K,e)}_renderChild(t){}_buildCssClass(){return['task-item']}cssClassSwitch(){const t=m(this,J,tt).call(this);let e,s;if('object'==typeof this.manager.options.theme){let n=this.manager.options.theme[this.status]||!1;n&&(e=Z.getClassName('theme-'+n),s=Z.getClassName('theme'),z(t,e,s))}e=u(Z,Z,et).call(Z)[this.status],s=Z.getClassName('status'),z(t,e,s)}refresh(t,e=null){m(this,J,tt).call(this),e&&this._refreshElements(e,t)}getProgressTotal(t='progress'){let e=0;return this.hasOwnProperty(t)&&(e=this[t],'object'==typeof e&&e.length&&(e=Math.round(e.reduce(((t,e)=>t+e))/e.length,0))),e}_refreshElements(t,e){const s=this.options.parts;Object.keys(t).forEach((n=>{let a=s[n],i='refreshBasicProperty';if('string'==typeof a){if(a.indexOf('.')>0){let[t,e]=a.split('.');i=t+e[0].toUpperCase()+e.slice(1),a=e}const s=void 0!==this[a]?this[a]:null;s!==(void 0!==e[a]?e[a]:null)&&(i='_'+i,'function'==typeof this[i]&&this[i].call(this,t[n],s,a))}}))}_refreshBasicProperty(t,e,s){if(Array.isArray(e)){const n=Z.getClassName('list-'+s);let a=$('ul.'+n,t);null===a&&(a=this.createEl('ul',{className:n}),t.append(a)),e.forEach(((t,e)=>{let s=$(`li:nth-child(${e+1})`,a);null===s?a.append(I('li',{},{},t)):s.innerText!==t&&(s.innerText=t)}))}else t.innerHTML=e}get manager(){return l(this,K)}get element(){return l(this,Q)}get options(){return this.manager.options.taskOptions}get statusText(){return this.manager.options.statusText[this.status]||''}getTitle(){return''}toString(){return this.statusText+' '+this.getTitle()}}function tt(){if(l(this,Q))return l(this,Q);const t=c(this,Q,this.createEl('div',{className:'wrapper'},{'data-task-id':this.id})),e=this.createEl('div',{className:this._buildCssClass()});return this._renderChild(e),t.append(e),t}var et={writable:!0,value:function(){if(this._cssList)return this._cssList;this._cssList={};for(let t in Y)'number'==typeof Y[t]&&(this._cssList[Y[t]]=H.getClassName('status-'+t.toLowerCase()));return this._cssList}};const st='__EMPTY__',nt={method:'post',delayTime:1e3,params:{}};var at=new WeakMap,it=new WeakMap,rt=new WeakMap,ot=new WeakSet,lt=new WeakSet,ct=new WeakSet;class ht{constructor(t){ct.add(this),lt.add(this),ot.add(this),at.set(this,{writable:!0,value:[]}),it.set(this,{writable:!0,value:void 0}),rt.set(this,{writable:!0,value:-1});const e=c(this,it,U({},nt,t));var s;e.params&&(k(s=e.params)&&'[object Object]'===E.call(s)&&s.constructor===Object)&&(e.params=Object.entries(e.params).map((([t,e])=>`${t}=${e}`)))}resolve(t,e){if(!1===this.isRunning){const s=m(this,ct,ft).call(this);c(this,rt,0),s.forEach((e=>t(e))),m(this,ot,ut).call(this,0).catch((t=>{})).then((()=>{const t=l(this,rt);return s.forEach((s=>e(s,t))),c(this,rt,-1),t}))}}get tasks(){let t=[];return l(this,at).forEach((e=>{e.getTasks().forEach((e=>{!1===e.common&&t.push(e)}))})),t}get tasksId(){return this.tasks.map((t=>t.id)).filter(((t,e,s)=>s.indexOf(t===e)))}findTasks(t){return this.tasks.filter((e=>e.id===t))}get options(){return l(this,it)}get isRunning(){return l(this,rt)>-1}static factory(t){const e=t.options.resolver,s=G.str(e.url),n=u(ht,ht,mt),a=u(ht,ht,gt),i=n[s]=n[s]instanceof ht?n[s]:new ht(e),r=m(i,ct,ft).call(i);return-1===r.indexOf(t)&&(r.push(t),t.options.common&&a.push(t),t.ownerElement.addEventListener(Te.Events.destroy,(t=>{let e=r.indexOf(t.manager);e>-1&&(a.forEach((t=>{t.getTasks().filter((t=>t.initiatorManager===r[e])).forEach((e=>{t.removeTask(e)}))})),r.splice(e,1)),e=a.findIndex((e=>e===t.manager)),e>-1&&a.splice(e,1)}))),i}}function ut(t=this.options.delayTime){return m(this,lt,pt).call(this,t).then((t=>{if(!1===t.ok)throw Error(`${t.status} - ${t.statusText}' `);return t.json().then((t=>(t.length>0&&(t.forEach((t=>{this.findTasks(t.id).forEach((e=>{e.manager._updateTask(e,t)}))})),d(ht,ht,dt).call(ht,t,this)),m(this,ot,ut).call(this))))}))}function dt(t,e){u(ht,ht,gt).forEach((s=>{t.forEach((t=>{let n=s.findTask(t.id);null===n&&!1===Y.is(Y.SET_COMPLETE,t.status)&&(t.common=!0,s.addTasks([t.id],!1),n=s.findTask(t.id),s._updateTask(n,t),n.initiatorManager=e.tasks.find((e=>e.id===t.id))?.manager),n instanceof Z&&n.common&&s._updateTask(n,t)}))}))}function pt(t){return new Promise(((e,s)=>{const n=this.tasksId;0===n.length?s(st):setTimeout((()=>e(n)),t)})).then((t=>{c(this,rt,+l(this,rt)+1);let e=t.map((t=>`t[]=${t}`)),s=this.options.params;return Array.isArray(s)&&s.length>0&&(e=e.concat(s)),fetch(this.options.url,U({},this.options,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:encodeURI(e.join('&'))}))}))}function ft(t=!1){return!1===t?l(this,at):l(this,at).filter((t=>!0===t.options.common))}var mt={writable:!0,value:[]},gt={writable:!0,value:[]};const wt={ready:'qmc:manager:ready',destroy:'qmc:manager:destroy',statusChange:'qmc:manager:statusChange',fetchStart:'qmc:resolver:start',fetchEnd:'qmc:resolver:end',toString:function(){const t=[];return y(this,(e=>{t.push(e)})),t.join(' ')}};var bt=new WeakMap;class vt extends CustomEvent{constructor(t,e,s){super(e,s),bt.set(this,{writable:!0,value:null}),c(this,bt,t)}get manager(){return l(this,bt)}}let Et,yt=3;r.default.WeakMap||(Et=class{constructor(){this.vdata='vdata'+Math.floor(r.default.performance&&r.default.performance.now()||Date.now()),this.data={}}set(t,e){const s=t[this.vdata]||yt++;return t[this.vdata]||(t[this.vdata]=s),this.data[s]=e,this}get(t){const e=t[this.vdata];if(e)return this.data[e]}has(t){return t[this.vdata]in this.data}delete(t){const e=t[this.vdata];e&&(delete this.data[e],delete t[this.vdata])}});var kt=r.default.WeakMap?new WeakMap:new Et,Tt=new WeakMap,Ct=new WeakMap,Nt=new WeakMap,xt=new WeakSet;class Mt extends H{constructor(...t){super(),xt.add(this),o(this,'label',''),o(this,'className',Mt.getClassName('progress')),o(this,'size',null),Tt.set(this,{writable:!0,value:[]}),o(this,'barOptions',{}),Ct.set(this,{writable:!0,value:null}),Nt.set(this,{writable:!0,value:null}),o(this,'isShowGradient',!0),U(this,...t)}render(){let t=l(this,Nt);if(t instanceof HTMLElement)return t;let e=this.className;return this.size&&(e+=' '+Mt.getClassName('size-'+this.size)),!1===this.isShowGradient&&(e+=' '+Mt.getClassName('no-gradient')),t=I('div',{className:e},{},I('div',{className:Mt.getClassName('progress-items')})),c(this,Nt,t)}setProgress(t){const e=l(this,Tt),s=l(this,Nt);t.length,(t='number'==typeof t?[t]:t).forEach(((t,n)=>{e[n]instanceof Wt?e[n].progress=t:(e[n]=new Wt(this.barOptions,{progress:t}),s.querySelector('.'+Mt.getClassName('progress-items')).append(I('div',{className:Mt.getClassName('progress-item')},{},e[n].render())))}));const n=Mt.getClassName('more-than-three');!1===R(s,n)&&t.length>3&&j(s,n)}setLabel(t){t&&(m(this,xt,Ot).call(this).innerHTML=t)}}function Ot(){let t=l(this,Ct);return t instanceof Element||(c(this,Ct,t=I('span',{className:Mt.getClassName('progress-label')},{})),l(this,Nt).append(t)),t}o(Mt,'$classPrefix',null);var St=new WeakMap,At=new WeakMap;class Wt{constructor(...t){St.set(this,{writable:!0,value:!1}),o(this,'className','progress-bar'),At.set(this,{writable:!0,value:0}),o(this,'labelText',''),o(this,'min',0),o(this,'max',100),U(this,...t)}render(){let t=l(this,St);if(t)return t;let e=[];return!1===this.labelText?e.push(I('span',{className:'sr-only',css:{width:0}},{},this.label)):e=this.label,c(this,St,t=I('div',{className:Mt.getClassName(this.className)},{role:'progressbar','aria-valuenow':this.progress,'aria-valuemin':this.min,'aria-valuemax':this.max},e)),t}get label(){const t=this.labelText?this.labelText:'';return`${this.progress}% ${t}`}get progress(){return l(this,At)}set progress(t){c(this,At,t);const e=this.render();e.setAttribute('aria-valuenow',t),e.childNodes.length>0?e.childNodes[0].textContent=this.label:e.textContent=this.label,e.style.width=`${t}%`}}var Pt=new WeakMap,Lt=new WeakMap,_t=new WeakMap,It=new WeakSet;class Rt extends H{constructor(t=!1,e=!1){super(),It.add(this),Pt.set(this,{writable:!0,value:void 0}),Lt.set(this,{writable:!0,value:!1}),_t.set(this,{writable:!0,value:!1}),c(this,Lt,t),c(this,_t,e)}render(){let t=l(this,Pt);return t instanceof Element?t:c(this,Pt,this.createEl('span',{className:m(this,It,jt).call(this)},{},I('span',{},{},['s1','s2','s3'].map((t=>I('span',{className:t}))))))}set icon(t){if(t){let e=l(this,Lt);if(e!==t){const s=l(this,Pt);e&&q(s,e),j(s,t),c(this,Lt,t)}}}set size(t){if(t){t=Rt.getClassName('size-'+t);const e=l(this,_t);if(e!==t){const s=l(this,Pt);e&&q(s,e),j(s,t),c(this,_t,t)}}}set color(t){B('span[class^=s]',l(this,Pt)).forEach((e=>{e.style.backgroundColor=t}))}}function jt(){let t='icon-t',e=[];return l(this,Lt)&&(t+=' '+l(this,Lt)),e.push(t),l(this,_t)&&e.push('size-'+l(this,_t)),e}const qt={tagName:'button',handler:null,handlerTimoutDelay:500,label:!1,hiddenLabel:'',disabled:!1,size:null,iconName:null,iconHoverName:null,iconSize:null,animatedClick:!0,data:{}};var Ft=new WeakMap,zt=new WeakMap,Dt=new WeakMap,$t=new WeakSet;class Bt extends H{constructor(t){super(),$t.add(this),Ft.set(this,{writable:!0,value:void 0}),zt.set(this,{writable:!0,value:qt}),Dt.set(this,{writable:!0,value:null}),t&&'object'==typeof t&&c(this,zt,U({},qt,t))}render(){let t=l(this,Ft);if(t instanceof Element)return t;const e=this.options,s=[];if(e.iconName){const t=this.icon;s.push(t.render()),t.icon=e.iconName,t.size=e.iconSize}if(e.label&&s.push(I('p',{},{},e.label)),e.hiddenLabel&&s.push(this.createEl('p',{className:'button-hidden'},{},e.hiddenLabel)),e.animatedClick){const t=I('p',{className:'drop'});t.addEventListener('animationend',(function(){q(this,'animate')})),s.push(t)}return t=c(this,Ft,this.createEl(e.tagName,{className:d(Bt,Bt,Ht).call(Bt,e)},{},s)),this.disabled=e.disabled,m(this,$t,Xt).call(this,t,e),t}set disabled(t){const e=this.options;t!==e.disabled&&('button'===e.tagName.toLowerCase()?l(this,Ft).disabled=t:function(t,e,s){const n=R(t,e);if('function'==typeof s&&(s=s(t,e)),'boolean'!=typeof s&&(s=!n),s!==n)s?j(t,e):q(t,e)}(l(this,Ft),'disabled'),e.disabled=t)}get options(){return l(this,zt)}get element(){return this.render()}get icon(){let t=l(this,Dt);return t instanceof Rt?t:c(this,Dt,new Rt)}}function Ht(t){let e=['button'];return t.size&&e.push('size-'+t.size),t.hiddenLabel&&e.push('has-hidden'),e}function Xt(t,e){t.addEventListener('click',(s=>{if(e.disabled)return s.stopImmediatePropagation(),!1;e.animatedClick&&d(Bt,Bt,Gt).call(Bt,t)})),'function'==typeof e.handler&&(e.handlerTimoutDelay>0?t.addEventListener('click',(t=>{setTimeout((()=>e.handler.call(this,t)),e.handlerTimoutDelay)})):t.addEventListener('click',e.handler.bind(this))),e.iconHoverName&&(t.addEventListener('mouseenter',(()=>{!1===e.disabled&&(this.icon.icon=e.iconHoverName)})),t.addEventListener('mouseleave',(()=>{this.icon.icon=e.iconName})))}function Gt(t){const e=$('.drop',t);if(e){const s=function(t){if(t&&t.getBoundingClientRect&&t.parentNode){const e=t.getBoundingClientRect(),s={};return['bottom','height','left','right','top','width'].forEach((t=>{void 0!==e[t]&&(s[t]=e[t])})),s.height||(s.height=parseFloat(T(t,'height'))),s.width||(s.width=parseFloat(T(t,'width'))),s}}(t),n=event.pageX-s.width/2-s.left-window.scrollX,a=event.pageY-s.height/2-s.top-window.scrollY;e.style.top=a+'px',e.style.left=n+'px',j(e,'animate')}}Bt.Defaults=qt;const Vt={buttons:[],arrange:!1,scaled:!1,selectable:!1,selectIcon:null};var Ut=new WeakMap,Yt=new WeakMap,Kt=new WeakSet;class Qt extends H{constructor(t){super(),Kt.add(this),o(this,'buttons',null),Ut.set(this,{writable:!0,value:Vt}),Yt.set(this,{writable:!0,value:void 0});const e=H.removeOptionsPtoperty('buttons',t,Array);c(this,Ut,U({},Vt,t)),this.buttons=e.map((t=>new Bt(t)))}render(){let t=l(this,Yt);return t instanceof Element||(c(this,Yt,t=this.createEl('div',{className:d(Qt,Qt,Jt).call(Qt,this.options)},{},this.buttons.map((t=>t.render())))),this.options.selectable&&m(this,Kt,Zt).call(this,t)),t}get options(){return l(this,Ut)}set arrange(t){const e=Qt.getClassName('arrange');let s=l(this,Yt),n=l(this,Ut);s&&(t?!1===R(s,e)&&j(s,e):q(s,e)),n.arrange=t}set selected(t){const e=Qt.getClassName('selected'),s=this.options;'number'==typeof t&&(t=this.buttons[t]),t instanceof Bt&&(this.buttons.forEach((t=>{F(t.element,'data-group-selected'),q(t.element,e)})),j(t.element,e),s.selectIcon&&(t.icon.icon=s.selectIcon,t.options.iconName=s.selectIcon))}}function Jt(t){let e=['button-group'];return t.arrange&&e.push('arrange'),t.scaled&&e.push('scaled'),e}function Zt(t){t.addEventListener('click',(t=>{const e=t.target.closest('.'+Qt.getClassName('button'));this.selected=this.buttons.find((t=>t.element===e))})),t.addEventListener('mouseenter',(t=>{this.$$('.button.selected',t.target).forEach((t=>{!function(t,e,s){t.setAttribute(e,s)}(t,'data-group-selected',!0),q(t,Qt.getClassName('selected'))}))})),t.addEventListener('mouseleave',(t=>{this.$$('.button[data-group-selected]',t.target).forEach((t=>{F(t,'data-group-selected'),j(t,Qt.getClassName('selected'))}))}))}var te=new WeakMap,ee=new WeakMap,se=new WeakMap,ne=new WeakMap,ae=new WeakMap;class ie extends H{constructor(t,e,s){super(),te.set(this,{writable:!0,value:[]}),o(this,'map',{icons:[],actions:[]}),ee.set(this,{writable:!0,value:void 0}),se.set(this,{writable:!0,value:null}),ne.set(this,{writable:!0,value:null}),ae.set(this,{writable:!0,value:null}),c(this,ee,t),this.map.icons=e,this.map.actions=s,c(this,se,new Rt('none','big')),c(this,ne,this.createEl('span',{className:'status-text'})),s.forEach((e=>{U(e,{data:{task:t}})}))}render(){let t=l(this,te);return t.length>0||(t.push(l(this,se).render()),t.push(l(this,ne)),this.map.actions.length>0&&(c(this,ae,new Qt({buttons:this.map.actions,arrange:!1,scaled:!0})),t.push(l(this,ae).render()))),t}refresh(t){l(this,ne).innerHTML=l(this,ee).statusText,l(this,se).icon=this.map.icons[t];const e=l(this,ae);e&&e.buttons.forEach((e=>{let s=e.options?.enabledWithStatus;if('function'==typeof s&&(s=s.call(e,t)),Array.isArray(s)){if(0===e.options.enabledWithStatus.length)return;e.disabled=-1===e.options.enabledWithStatus.indexOf(t)}else'boolean'==typeof s&&(e.disabled=s)}))}}const re={iconPlacement:'default',parts:{status:'refresh.status',title:'title',text:'text',error:'errors','progress-wrapper':'refresh.progress'},progress:{label:'',size:'',barOptions:{labelText:!1}},actions:[]},oe={};oe[Y.WAIT]='clock',oe[Y.EXEC]='play',oe[Y.ERROR]='warning',oe[Y.DONE]='checked';var le=new WeakMap;class ce extends Z{constructor(...t){super(...t),le.set(this,{writable:!0,value:{}})}_renderChild(t){const e=l(this,le),s=this.options,n=t.appendChild(this.createEl('div',{className:'detail'})),a=t.appendChild(this.createEl('div',{className:'status-wrapper'}));Object.keys(s.parts).forEach((t=>{let i=n,r=null;if('progress-wrapper'===t?s.progress?r=new Mt(s.progress):delete s['progress-wrapper']:'status'===t&&(i=a,r=new ie(this,oe,s.actions)),e[t]=i.appendChild(this.createEl('div',{className:t},{})),r&&'function'==typeof r?.render){let s=r.render();s instanceof Element&&(s=[s]),s.forEach((s=>e[t].append(s))),d(ce,ce,he).call(ce,e[t],r)}}))}refresh(t){super.refresh(t,l(this,le))}_buildCssClass(){const t=super._buildCssClass();return this.options.iconPlacement!==re.iconPlacement&&t.push('task-item-'+this.options.iconPlacement),t}_refreshProgress(t,e){const s=d(ce,ce,ue).call(ce,t);s instanceof Mt&&(s.setLabel(this.getProgressTotal()+'%'),s.setProgress(e))}_refreshStatus(t,e){d(ce,ce,ue).call(ce,t).refresh(e)}getTitle(){const t=this.options.parts.title;return t?this[t]??'':''}}function he(t,e){kt.has(t)||kt.set(t,{});kt.get(t).componet=e}function ue(t){if(kt.has(t)){const e=kt.get(t);if(void 0!==e.componet)return e.componet}return null}ce.Defualts=re;const de={linear:t=>t,quad:t=>Math.pow(t,2),circ:t=>1-Math.sin(Math.acos(t)),back:(t=1.5,e)=>Math.pow(e,2)*((t+1)*e-t)},pe={fadeOut:function(t){this.style.opacity=1-Math.round(100*t)/100},fadeIn:function(t){'none'===this.style.display&&(this.style.display=null),this.style.opacity=Math.round(100*t)/100}};function fe(t,e={name:'fadeOut',timing:de.linear,duration:500,delay:0}){let s=Object.assign({},e);if('function'==typeof s.draw)s.draw.bind(t);else{if('string'!=typeof s.name||'function'!=typeof pe[s.name])throw new Error('Unknown animation ');s.draw=pe[s.name].bind(t)}return'number'!=typeof s.delay&&(s.delay=0),s.timing='string'==typeof s.timing&&'function'==typeof de[s.timing]?de[s.timing]:de.linear,new Promise((e=>{setTimeout((()=>function({timing:t,draw:e,duration:s},n){let a=performance.now();requestAnimationFrame((function i(r){let o=(r-a)/s;o>1&&(o=1);let l=t(o);e(l),o<1?requestAnimationFrame(i):n&&n()}))}(s,(()=>{e(t)}))),s.delay)}))}const me={common:!1,title:'<h3>Backgrounds tasks</h3>',theme:{'-1':'default'},renderOnEmpty:!0,taskClass:ce,emptyText:'Tasks not provided yet',taskOptions:{},tasks:[],statusText:{},hideAnimation:{name:'fadeOut',duration:1e3,timing:'linear',delay:0},showAnimation:{name:'fadeIn',duration:1e3,timing:'linear',delay:0},tasksAnimation:{hide:{},show:{}},resolver:{url:'queue-reader'}};me.tasksAnimation.hide[Y.DONE]=U({},me.hideAnimation,{delay:5e3}),me.tasksAnimation.hide[Y.ERROR]=U({},me.hideAnimation,{delay:2e4}),me.tasksAnimation.show[Y.EXEC]=U({},me.showAnimation,{duration:500}),me.tasksAnimation.show[Y.WAIT]=U({},me.showAnimation,{duration:500}),me.tasksAnimation.hide[Y.ERROR]=!1,me.statusText[Y.DONE]='Complete',me.statusText[Y.ERROR]='Complete with errors',me.statusText[Y.EXEC]='Processing',me.statusText[Y.WAIT]='Awaiting';var ge=new WeakMap,we=new WeakMap,be=new WeakMap,ve=new WeakMap,Ee=new WeakSet,ye=new WeakSet,ke=new WeakSet;class Te extends H{constructor(t){super(),ke.add(this),ye.add(this),Ee.add(this),ge.set(this,{writable:!0,value:null}),we.set(this,{writable:!0,value:{owner:null,wrapper:null,wrapperTasks:null,emptyText:null}}),be.set(this,{writable:!0,value:[]}),ve.set(this,{writable:!0,value:{}}),l(this,we).owner=H.removeOptionsPtoperty('element',t);let e=U({},Te.Defaults,t);c(this,ve,U({},{taskOptions:e.taskClass.Defualts},e)),c(this,ge,ht.factory(this)),this.render(),t.tasks&&void 0!==t.tasks.length&&this.addTasks(t.tasks),setTimeout((()=>{0===this.getTasks().length&&m(this,Ee,Ce).call(this,'show')}),200),this.trigger(wt.ready,{bubbles:!0})}destroy(){this.trigger(wt.destroy,{bubbles:!0}),c(this,be,[]),this.ownerElement.remove()}get options(){return l(this,ve)}trigger(t,e={},s){if('object'==typeof s){e.detail={};for(const[t,n]of Object.entries(s))e.detail[t]=n}return this.ownerElement.dispatchEvent(new vt(this,t,e))}render(){const t=this.getTasks(Y.SET_VISIBLE);if(0===t.length&&!1===this.options.renderOnEmpty)return!1;const e=l(this,we);if(null===e.wrapper){const t=this.options;e.wrapper=e.owner.appendChild(this.createEl('div',{className:'wrapper'})),0===e.wrapper.childNodes.length&&(t.title&&this.options.title.length>0&&e.wrapper.appendChild(this.createEl('div',{innerHTML:this.options.title,className:'title'})),e.wrapperTasks=e.wrapper.appendChild(this.createEl('div',{className:'tasks'})),t.emptyText.length>0&&(e.emptyText=e.wrapper.appendChild(e.emptyText=this.createEl('div',{className:'empty-wrapper',style:{display:'none'}},{},[this.createEl('span',{className:'empty-text',textContent:t.emptyText})])))),'string'==typeof t.theme&&z(e.wrapper,Te.getClassName('theme-'+t.theme),Te.getClassName('theme'))}return t.forEach((t=>t.refresh())),!0}addTasks(t,e=!0){t&&t.length>0&&(c(this,be,l(this,be).concat(t)),m(this,Ee,Ce).call(this,'hide').then((()=>{e&&this.resolver.resolve((t=>{t.getTasks().length>0&&t.trigger(wt.fetchStart,{bubbles:!0})}),((t,e)=>{t.trigger(wt.fetchEnd,{bubbles:!0},{requests:e})}))})))}_updateTask(t,e){if(t.progress!==e.progress||t.status!==e.status||t.text!==e.text||t.title!==e.title){const s=t.status!==e.status,n=U({},t);if((t=U(t,e)).refresh(n),s){if(t.cssClassSwitch(),Y.is([Y.EXEC],t.status),this.trigger(wt.statusChange,{bubbles:!0},{task:t,oldStatus:n.status}),Y.is(Y.SET_VISIBLE,t.status)&&null===t.element.parentNode){const e=t.element;e.style.display='none',this.wrapperTasksElement.append(e),fe(e,m(this,ye,Ne).call(this,t,'show'))}Y.is(Y.SET_COMPLETE,t.status)&&t.element.parentNode instanceof Element&&this.removeTask(t)}}}removeTask(t,e=null){let s=this.getTasks();if('number'==typeof t&&(t=s.find((e=>e.id===t))),t instanceof Z){const s=this.getTasks().findIndex((e=>e.id===t.id));if(s>-1)return l(this,be).splice(s,1),m(this,ke,xe).call(this,t.element,m(this,ye,Ne).call(this,t)).then((t=>{e&&e(t),0===l(this,be).length&&m(this,Ee,Ce).call(this,'show')})),!0}return!1}getTasks(t){let e=l(this,be);const s=this.options.taskClass;return e.forEach(((t,n)=>{t instanceof Z||('object'==typeof t?e[n]=U(new s(null,this),t):Number.parseInt(t)>0&&(e[n]=new s(t,this)))})),t?('number'==typeof t&&(t=[t]),e.filter((e=>{if(t.indexOf(e.status)>-1)return e}))):e}findTask(t){const e=this.getTasks().find((e=>e.id===t));return e instanceof Z?e:null}get ownerElement(){return l(this,we).owner}get wrapperElement(){return l(this,we).wrapper}get wrapperTasksElement(){return l(this,we).wrapperTasks}get resolver(){return l(this,ge)}}function Ce(t){const e=l(this,we).emptyText,s=function(t){return!1!==L(t)&&(0!==(''!==t.style?.opacity?parseFloat(t.style.opacity):1)&&'hidden'!==T(t,'visibility')&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length))}(e);if(L(e)){if(s&&'hide'===t||!1===s&&'show'===t)return fe(e,this.options[t+'Animation']);e.style.display='show'===t?'block':'none'}return Promise.resolve(e)}function Ne(t,e='hide'){const s=this.options;return void 0!==s.tasksAnimation[e][t.status]?s.tasksAnimation[e][t.status]:s[e+'Animation']}function xe(t,e=this.options.hideAnimation){return!1!==e?fe(t,e).then((t=>(t.remove(),t))):Promise.resolve(!1)}H.classPrefix='qmc-',Te.TaskAbstract=Z,Te.Button=Bt,Te.ButtonsGroup=Qt,Te.Icon=Rt,Te.Defaults=me,Te.Events=wt,Te.Statuses=Y,a.default.fn.queueManager=function(t){const e=this.data('queue-manager'),s={init:function(t){return this.each(((e,s)=>{const n=a.default(s);n.data('queueManager')||n.data('queueManager',new Te(a.default.extend(!0,{element:n.get(0)},Te.Defaults,t||{},n.data('manager')||{})))})),this},createButtons:function(t,s){(s=s||this).append(a.default(new Te.ButtonsGroup(t).render()).data('manager',e))}};return e instanceof Te&&'function'==typeof e[t]?e[t].apply(e,Array.prototype.slice.call(arguments,1)):s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):'object'!=typeof t&&t?(a.default.error('Method '+t+' does not exist on queueManager '),!1):s.init.apply(this,arguments)},a.default.fn.queueManager.Manager=Te,a.default('document').ready((()=>{a.default('.qmc-queue-manager[data-manager]').queueManager()}))}(window.jQuery,document,window);
