/*!
 * @license
 * yii2-queue-manager-client 0.1.0 <https://github.com/somov/yii2-queue-manager-client#readme>
 * Copyright: somov.nn@gmail.com
 * Licensed under MIT
 */
!function(t,e,s){function n(t){return t&&'object'==typeof t&&'default'in t?t:{default:t}}var a=n(t),i=n(e),r=n(s);function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function l(t,e){return p(t,h(t,e,'get'))}function c(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError('attempted to set read only private field');e.value=s}}(t,h(t,e,'set'),s),s}function h(t,e,s){if(!e.has(t))throw new TypeError('attempted to '+s+' private field on non-instance');return e.get(t)}function u(t,e,s){return f(t,e),function(t,e){if(void 0===t)throw new TypeError('attempted to '+e+' private static field before its declaration')}(s,'get'),p(t,s)}function d(t,e,s){return f(t,e),s}function p(t,e){return e.get?e.get.call(t):e.value}function f(t,e){if(t!==e)throw new TypeError('Private static access of wrong provenance')}function m(t,e,s){if(!e.has(t))throw new TypeError('attempted to get private field on non-instance');return s}const g={prefixed:!0},w=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror','fullscreen'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror','-webkit-full-screen'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror','-moz-full-screen'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError','-ms-fullscreen']],b=w[0];let v;for(let t=0;t<w.length;t++)if(w[t][1]in i.default){v=w[t];break}if(v){for(let t=0;t<v.length;t++)g[b[t]]=v[t];g.prefixed=v[0]!==b[0]}function E(t,e){(t=>y(t)?Object.keys(t):[])(t).forEach((s=>e(t[s],s)))}function y(t){return!!t&&'object'==typeof t}function k(t,e){if(!t||!e)return'';if('function'==typeof r.default.getComputedStyle){const s=r.default.getComputedStyle(t);return s?s.getPropertyValue(e)||s[e]:''}return''}const T=r.default.navigator&&r.default.navigator.userAgent||'',C=/AppleWebKit\/([\d.]+)/i.exec(T);C&&parseFloat(C.pop()),/iPod/i.test(T),(()=>{const t=T.match(/OS (\d+)_/i);t&&t[1]&&t[1]})();const N=/Android/i.test(T);(()=>{const t=T.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const e=t[1]&&parseFloat(t[1]),s=t[2]&&parseFloat(t[2]);e&&s&&parseFloat(t[1]+'.'+t[2])})(),/Firefox/i.test(T);const x=/Edg/i.test(T),M=!x&&(/Chrome/i.test(T)||/CriOS/i.test(T));(()=>{const t=T.match(/(Chrome|CriOS)\/(\d+)/);t&&t[2]&&parseFloat(t[2])})(),(()=>{const t=/MSIE\s(\d+)\.\d/.exec(T);let e=t&&parseFloat(t[1]);!e&&/Trident\/7.0/i.test(T)&&/rv:11.0/.test(T)&&(e=11)})();const O=/Safari/i.test(T)&&!M&&!N&&!x;/Windows/i.test(T);const S=Boolean(i.default===r.default.document&&('ontouchstart'in r.default||r.default.navigator.maxTouchPoints||r.default.DocumentTouch&&r.default.document instanceof r.default.DocumentTouch));/iPad/i.test(T)||O&&S&&/iPhone/i.test(T);function W(t){return'string'==typeof t&&Boolean(t.trim())}function A(t){if(t.indexOf(' ')>=0)throw new Error('class has illegal whitespace characters')}function P(t){return y(t)&&1===t.nodeType}function L(t){return(e,s)=>{if(!W(e))return i.default[t](null);W(s)&&(s=i.default.querySelector(s));const n=P(s)?s:i.default;return n[t]&&n[t](e)}}function _(t='div',e={},s={},n){const a=i.default.createElement(t);return Object.getOwnPropertyNames(e).forEach((t=>{const s=e[t];-1!==t.indexOf('aria-')||'role'===t||'type'===t?a.setAttribute(t,s):'style'===t&&'object'==typeof s?Object.getOwnPropertyNames(s).forEach((t=>{a.style[t]=s[t]})):'textContent'===t?function(t,e){void 0===t.textContent?t.innerText=e:t.textContent=e}(a,s):a[t]===s&&'tabIndex'!==t||(a[t]=s)})),Object.getOwnPropertyNames(s).forEach((t=>{a.setAttribute(t,s[t])})),n&&function(t,e){(function(t){'function'==typeof t&&(t=t());return(Array.isArray(t)?t:[t]).map((t=>('function'==typeof t&&(t=t()),P(t)||function(t){return y(t)&&3===t.nodeType}(t)?t:'string'==typeof t&&/\S/.test(t)?i.default.createTextNode(t):void 0))).filter((t=>t))})(e).forEach((e=>t.appendChild(e)))}(a,n),a}function I(t,e){return A(e),t.classList?t.classList.contains(e):(s=e,new RegExp('(^|\\s)'+s+'($|\\s)')).test(t.className);var s}function R(t,e){return t.classList?t.classList.add(e):I(t,e)||(t.className=(t.className+' '+e).trim()),t}function F(t,e){return t.classList?t.classList.remove(e):(A(e),t.className=t.className.split(/\s+/).filter((t=>t!==e)).join(' ')),t}function j(t,e){t.removeAttribute(e)}function z(t,e,s,n=(t=>t.startsWith(s)?t:'')){let a='';t.classList.forEach((t=>{0===a.length&&(a=n(t))})),a!==e&&(a.length>0&&F(t,a),R(t,e))}var q;/iPhone/i.test(T),(q=Element.prototype).matches=q.matches||q.mozMatchesSelector||q.msMatchesSelector||q.oMatchesSelector||q.webkitMatchesSelector,q.closest=q.closest||function(t){return this?this.matches(t)?this:this.parentElement?this.parentElement.closest(t):null:null};const D=L('querySelector'),$=L('querySelectorAll');class B{static removeOptionsPtoperty(t,e,s=Element){if(e[t]instanceof s==!1)throw Error('Invalid call. Property '+t+' is not valid');{const s=e[t];return delete e[t],s}}createEl(t='div',e={},s={},n){if(void 0!==e.className){const t=new Set;('string'==typeof e.className?e.className.split(' '):e.className).forEach((e=>t.add(e)));let s='';for(let e of t)s+=' '+B.getClassName(e);e.className=s.trim()}return _(t,e,s,n)}static _normalizePrefix(t){return t.replace(new RegExp('\\.','g'),'$&'+B.classPrefix)}$(t,e){return t=B._normalizePrefix(t),D(t,e)}$$(t,e){return t=B._normalizePrefix(t),$(t,e)}}Object.assign(B,{classPrefix:null,getClassName:function(t){return null===this.classPrefix||t.startsWith(this.classPrefix)?t:this.classPrefix+t}});var H,X=(((t,e)=>{var s;s=t=>{t.version='1.2.0';var e=(()=>{for(var t=0,e=new Array(256),s=0;256!=s;++s)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=s)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[s]=t;return'undefined'!=typeof Int32Array?new Int32Array(e):e})();t.table=e,t.bstr=(t,s)=>{for(var n=-1^s,a=t.length-1,i=0;i<a;)n=(n=n>>>8^e[255&(n^t.charCodeAt(i++))])>>>8^e[255&(n^t.charCodeAt(i++))];return i===a&&(n=n>>>8^e[255&(n^t.charCodeAt(i))]),-1^n},t.buf=(t,s)=>{if(t.length>1e4)return((t,s)=>{for(var n=-1^s,a=t.length-7,i=0;i<a;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])];for(;i<a+7;)n=n>>>8^e[255&(n^t[i++])];return-1^n})(t,s);for(var n=-1^s,a=t.length-3,i=0;i<a;)n=(n=(n=(n=n>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])];for(;i<a+3;)n=n>>>8^e[255&(n^t[i++])];return-1^n},t.str=(t,s)=>{for(var n,a,i=-1^s,r=0,o=t.length;r<o;)(n=t.charCodeAt(r++))<128?i=i>>>8^e[255&(i^n)]:n<2048?i=(i=i>>>8^e[255&(i^(192|n>>6&31))])>>>8^e[255&(i^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),a=1023&t.charCodeAt(r++),i=(i=(i=(i=i>>>8^e[255&(i^(240|n>>8&7))])>>>8^e[255&(i^(128|n>>2&63))])>>>8^e[255&(i^(128|a>>6&15|(3&n)<<4))])>>>8^e[255&(i^(128|63&a))]):i=(i=(i=i>>>8^e[255&(i^(224|n>>12&15))])>>>8^e[255&(i^(128|n>>6&63))])>>>8^e[255&(i^(128|63&n))];return-1^i}},'undefined'==typeof DO_NOT_EXPORT_CRC?s(e):s({})})(H={exports:{}},H.exports),H.exports);function G(t){return t&&'object'==typeof t&&!Array.isArray(t)}function V(t,...e){if(!e.length)return t;const s=e.shift();if(G(t)&&G(s))for(const e in s)G(s[e])?(t[e]||Object.assign(t,{[e]:{}}),V(t[e],s[e])):Object.assign(t,{[e]:s[e]});return V(t,...e)}const U='__EMPTY__',Y={method:'post',delayTime:1e3};var K=new WeakMap,Q=new WeakMap,J=new WeakMap,Z=new WeakSet,tt=new WeakSet,et=new WeakSet;class st{constructor(t){et.add(this),tt.add(this),Z.add(this),K.set(this,{writable:!0,value:[]}),Q.set(this,{writable:!0,value:void 0}),J.set(this,{writable:!0,value:-1}),c(this,Q,V({},Y,t))}resolve(t,e){if(!1===this.isRunning){const s=m(this,et,rt).call(this);c(this,J,0),s.forEach((e=>t(e))),m(this,Z,nt).call(this,0).catch((t=>{})).then((()=>{const t=l(this,J);return s.forEach((s=>e(s,t))),c(this,J,-1),t}))}}get tasks(){let t=[];return l(this,K).forEach((e=>{e.getTasks().forEach((e=>{!1===e.common&&t.push(e)}))})),t}get tasksId(){return this.tasks.map((t=>t.id)).filter(((t,e,s)=>s.indexOf(t===e)))}findTask(t){const e=this.tasks.find((e=>e.id===t));return e||!1}get options(){return l(this,Q)}get isRunning(){return l(this,J)>-1}static factory(t){const e=t.options.resolver,s=X.str(e.url),n=u(st,st,ot),a=u(st,st,lt),i=n[s]=n[s]instanceof st?n[s]:new st(e),r=m(i,et,rt).call(i);return-1===r.indexOf(t)&&(r.push(t),t.options.common&&a.push(t),t.ownerElement.addEventListener(ke.Events.destroy,(t=>{let e=r.indexOf(t.manager);e>-1&&(a.forEach((t=>{t.getTasks().filter((t=>t.initiatorManager===r[e])).forEach((e=>{t.removeTask(e)}))})),r.splice(e,1)),e=a.findIndex((e=>e===t.manager)),e>-1&&a.splice(e,1)}))),i}}function nt(t=this.options.delayTime){return m(this,tt,it).call(this,t).then((t=>{if(!1===t.ok)throw Error(`${t.status} - ${t.statusText}' `);return t.json().then((t=>(t.length>0&&(t.forEach((t=>{const e=this.findTask(t.id);e&&e.manager._updateTask(e,t)})),d(st,st,at).call(st,t,this)),m(this,Z,nt).call(this))))}))}function at(t,e){u(st,st,lt).forEach((s=>{t.forEach((t=>{let n=s.findTask(t.id);null===n&&(t.common=!0,t.title='',s.addTasks([t],!1),n=s.findTask(t.id),n.initiatorManager=e.tasks.find((e=>e.id===t.id))?.manager),n.common&&s._updateTask(n,t)}))}))}function it(t){return new Promise(((e,s)=>{const n=this.tasksId;0===n.length?s(U):setTimeout((()=>e(n)),t)})).then((t=>(c(this,J,+l(this,J)+1),fetch(this.options.url,V({},this.options,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:encodeURI(t.map((t=>`t[]=${t}`)).join('&'))})))))}function rt(t=!1){return!1===t?l(this,K):l(this,K).filter((t=>!0===t.options.common))}var ot={writable:!0,value:[]},lt={writable:!0,value:[]};const ct={ready:'qmc:manager:ready',destroy:'qmc:manager:destroy',statusChange:'qmc:manager:statusChange',fetchStart:'qmc:resolver:start',fetchEnd:'qmc:resolver:end',toString:function(){const t=[];return E(this,(e=>{t.push(e)})),t.join(' ')}},ht={INIT:-1,WAIT:0,EXEC:1,DONE:2,ERROR:3,DELETED:99};ht.SET_VISIBLE=[ht.WAIT,ht.EXEC,ht.ERROR,ht.DONE],ht.SET_COMPLETE=[ht.DONE,ht.ERROR,ht.DELETED],ht.is=(t,e)=>t.indexOf(e)>-1;var ut=new WeakMap;class dt extends CustomEvent{constructor(t,e,s){super(e,s),ut.set(this,{writable:!0,value:null}),c(this,ut,t)}get manager(){return l(this,ut)}}var pt=new WeakMap,ft=new WeakMap,mt=new WeakSet;class gt extends B{constructor(t,e){super(),mt.add(this),pt.set(this,{writable:!0,value:null}),o(this,'id',void 0),o(this,'common',!1),o(this,'initiatorManager',void 0),o(this,'progress',0),o(this,'text',''),o(this,'title',''),o(this,'status',ht.INIT),ft.set(this,{writable:!0,value:null}),this.id=parseInt(t),c(this,pt,e)}_renderChild(t){}_buildCssClass(){return['task-item']}cssClassSwitch(){const t=m(this,mt,wt).call(this);let e,s;if('object'==typeof this.manager.options.theme){let n=this.manager.options.theme[this.status]||!1;n&&(e=gt.getClassName('theme-'+n),s=gt.getClassName('theme'),z(t,e,s))}e=u(gt,gt,bt).call(gt)[this.status],s=gt.getClassName('status'),z(t,e,s)}refresh(t,e=null){m(this,mt,wt).call(this),e&&this._refreshElements(e,t)}getProgressTotal(t='progress'){let e=0;return this.hasOwnProperty(t)&&(e=this[t],'object'==typeof e&&e.length&&(e=Math.round(e.reduce(((t,e)=>t+e))/e.length,0))),e}_refreshElements(t,e){const s=this.options.parts;Object.keys(t).forEach((n=>{let a=s[n],i='refreshBasicProperty';if('string'==typeof a){if(a.indexOf('.')>0){let[t,e]=a.split('.');i=t+e[0].toUpperCase()+e.slice(1),a=e}const s=void 0!==this[a]?this[a]:null;s!==(void 0!==e[a]?e[a]:null)&&(i='_'+i,'function'==typeof this[i]&&this[i].call(this,t[n],s,a))}}))}_refreshBasicProperty(t,e,s){if(Array.isArray(e)){const n=gt.getClassName('list-'+s);let a=D('ul.'+n,t);null===a&&(a=this.createEl('ul',{className:n}),t.append(a)),e.forEach(((t,e)=>{let s=D(`li:nth-child(${e+1})`,a);null===s?a.append(_('li',{},{},t)):s.innerText!==t&&(s.innerText=t)}))}else t.innerHTML=e}get manager(){return l(this,pt)}get element(){return l(this,ft)}get options(){return this.manager.options.taskOptions}get statusText(){return this.manager.options.statusText[this.status]||''}getTitle(){return''}toString(){return this.statusText+' '+this.getTitle()}}function wt(){if(l(this,ft))return l(this,ft);const t=c(this,ft,this.createEl('div',{className:'wrapper'},{'data-task-id':this.id})),e=this.createEl('div',{className:this._buildCssClass()});return this._renderChild(e),t.append(e),t}var bt={writable:!0,value:function(){if(this._cssList)return this._cssList;this._cssList={};for(let t in ht)'number'==typeof ht[t]&&(this._cssList[ht[t]]=B.getClassName('status-'+t.toLowerCase()));return this._cssList}};let vt,Et=3;r.default.WeakMap||(vt=class{constructor(){this.vdata='vdata'+Math.floor(r.default.performance&&r.default.performance.now()||Date.now()),this.data={}}set(t,e){const s=t[this.vdata]||Et++;return t[this.vdata]||(t[this.vdata]=s),this.data[s]=e,this}get(t){const e=t[this.vdata];if(e)return this.data[e]}has(t){return t[this.vdata]in this.data}delete(t){const e=t[this.vdata];e&&(delete this.data[e],delete t[this.vdata])}});var yt=r.default.WeakMap?new WeakMap:new vt,kt=new WeakMap,Tt=new WeakMap,Ct=new WeakMap,Nt=new WeakSet;class xt extends B{constructor(...t){super(),Nt.add(this),o(this,'label',''),o(this,'className',xt.getClassName('progress')),o(this,'size',null),kt.set(this,{writable:!0,value:[]}),o(this,'barOptions',{}),Tt.set(this,{writable:!0,value:null}),Ct.set(this,{writable:!0,value:null}),o(this,'isShowGradient',!0),V(this,...t)}render(){let t=l(this,Ct);if(t instanceof HTMLElement)return t;let e=this.className;return this.size&&(e+=' '+xt.getClassName('size-'+this.size)),!1===this.isShowGradient&&(e+=' '+xt.getClassName('no-gradient')),t=_('div',{className:e},{},_('div',{className:xt.getClassName('progress-items')})),c(this,Ct,t)}setProgress(t){const e=l(this,kt),s=l(this,Ct);t.length,(t='number'==typeof t?[t]:t).forEach(((t,n)=>{e[n]instanceof Wt?e[n].progress=t:(e[n]=new Wt(this.barOptions,{progress:t}),s.querySelector('.'+xt.getClassName('progress-items')).append(_('div',{className:xt.getClassName('progress-item')},{},e[n].render())))}));const n=xt.getClassName('more-than-three');!1===I(s,n)&&t.length>3&&R(s,n)}setLabel(t){t&&(m(this,Nt,Mt).call(this).innerHTML=t)}}function Mt(){let t=l(this,Tt);return t instanceof Element||(c(this,Tt,t=_('span',{className:xt.getClassName('progress-label')},{})),l(this,Ct).append(t)),t}o(xt,'$classPrefix',null);var Ot=new WeakMap,St=new WeakMap;class Wt{constructor(...t){Ot.set(this,{writable:!0,value:!1}),o(this,'className','progress-bar'),St.set(this,{writable:!0,value:0}),o(this,'labelText',''),o(this,'min',0),o(this,'max',100),V(this,...t)}render(){let t=l(this,Ot);if(t)return t;let e=[];return!1===this.labelText?e.push(_('span',{className:'sr-only',css:{width:0}},{},this.label)):e=this.label,c(this,Ot,t=_('div',{className:xt.getClassName(this.className)},{role:'progressbar','aria-valuenow':this.progress,'aria-valuemin':this.min,'aria-valuemax':this.max},e)),t}get label(){const t=this.labelText?this.labelText:'';return`${this.progress}% ${t}`}get progress(){return l(this,St)}set progress(t){c(this,St,t);const e=this.render();e.setAttribute('aria-valuenow',t),e.childNodes.length>0?e.childNodes[0].textContent=this.label:e.textContent=this.label,e.style.width=`${t}%`}}var At=new WeakMap,Pt=new WeakMap,Lt=new WeakMap,_t=new WeakSet;class It extends B{constructor(t=!1,e=!1){super(),_t.add(this),At.set(this,{writable:!0,value:void 0}),Pt.set(this,{writable:!0,value:!1}),Lt.set(this,{writable:!0,value:!1}),c(this,Pt,t),c(this,Lt,e)}render(){let t=l(this,At);return t instanceof Element?t:c(this,At,this.createEl('span',{className:m(this,_t,Rt).call(this)},{},_('span',{},{},['s1','s2','s3'].map((t=>_('span',{className:t}))))))}set icon(t){if(t){let e=l(this,Pt);if(e!==t){const s=l(this,At);e&&F(s,e),R(s,t),c(this,Pt,t)}}}set size(t){if(t){t=It.getClassName('size-'+t);const e=l(this,Lt);if(e!==t){const s=l(this,At);e&&F(s,e),R(s,t),c(this,Lt,t)}}}set color(t){$('span[class^=s]',l(this,At)).forEach((e=>{e.style.backgroundColor=t}))}}function Rt(){let t='icon-t',e=[];return l(this,Pt)&&(t+=' '+l(this,Pt)),e.push(t),l(this,Lt)&&e.push('size-'+l(this,Lt)),e}const Ft={tagName:'button',handler:null,handlerTimoutDelay:500,label:!1,hiddenLabel:'',disabled:!1,size:null,iconName:null,iconHoverName:null,iconSize:null,animatedClick:!0,data:{}};var jt=new WeakMap,zt=new WeakMap,qt=new WeakMap,Dt=new WeakSet;class $t extends B{constructor(t){super(),Dt.add(this),jt.set(this,{writable:!0,value:void 0}),zt.set(this,{writable:!0,value:Ft}),qt.set(this,{writable:!0,value:null}),t&&'object'==typeof t&&c(this,zt,V({},Ft,t))}render(){let t=l(this,jt);if(t instanceof Element)return t;const e=this.options,s=[];if(e.iconName){const t=this.icon;s.push(t.render()),t.icon=e.iconName,t.size=e.iconSize}if(e.label&&s.push(_('p',{},{},e.label)),e.hiddenLabel&&s.push(this.createEl('p',{className:'button-hidden'},{},e.hiddenLabel)),e.animatedClick){const t=_('p',{className:'drop'});t.addEventListener('animationend',(function(){F(this,'animate')})),s.push(t)}return t=c(this,jt,this.createEl(e.tagName,{className:d($t,$t,Bt).call($t,e)},{},s)),this.disabled=e.disabled,m(this,Dt,Ht).call(this,t,e),t}set disabled(t){const e=this.options;t!==e.disabled&&('button'===e.tagName.toLowerCase()?l(this,jt).disabled=t:function(t,e,s){const n=I(t,e);if('function'==typeof s&&(s=s(t,e)),'boolean'!=typeof s&&(s=!n),s!==n)s?R(t,e):F(t,e)}(l(this,jt),'disabled'),e.disabled=t)}get options(){return l(this,zt)}get element(){return this.render()}get icon(){let t=l(this,qt);return t instanceof It?t:c(this,qt,new It)}}function Bt(t){let e=['button'];return t.size&&e.push('size-'+t.size),t.hiddenLabel&&e.push('has-hidden'),e}function Ht(t,e){t.addEventListener('click',(s=>{if(e.disabled)return s.stopImmediatePropagation(),!1;e.animatedClick&&d($t,$t,Xt).call($t,t)})),'function'==typeof e.handler&&(e.handlerTimoutDelay>0?t.addEventListener('click',(t=>{setTimeout((()=>e.handler.call(this,t)),e.handlerTimoutDelay)})):t.addEventListener('click',e.handler.bind(this))),e.iconHoverName&&(t.addEventListener('mouseenter',(()=>{!1===e.disabled&&(this.icon.icon=e.iconHoverName)})),t.addEventListener('mouseleave',(()=>{this.icon.icon=e.iconName})))}function Xt(t){const e=D('.drop',t);if(e){const s=function(t){if(t&&t.getBoundingClientRect&&t.parentNode){const e=t.getBoundingClientRect(),s={};return['bottom','height','left','right','top','width'].forEach((t=>{void 0!==e[t]&&(s[t]=e[t])})),s.height||(s.height=parseFloat(k(t,'height'))),s.width||(s.width=parseFloat(k(t,'width'))),s}}(t),n=event.pageX-s.width/2-s.left-window.scrollX,a=event.pageY-s.height/2-s.top-window.scrollY;e.style.top=a+'px',e.style.left=n+'px',R(e,'animate')}}$t.Defaults=Ft;const Gt={buttons:[],arrange:!1,scaled:!1,selectable:!1,selectIcon:null};var Vt=new WeakMap,Ut=new WeakMap,Yt=new WeakSet;class Kt extends B{constructor(t){super(),Yt.add(this),o(this,'buttons',null),Vt.set(this,{writable:!0,value:Gt}),Ut.set(this,{writable:!0,value:void 0});const e=B.removeOptionsPtoperty('buttons',t,Array);c(this,Vt,V({},Gt,t)),this.buttons=e.map((t=>new $t(t)))}render(){let t=l(this,Ut);return t instanceof Element||(c(this,Ut,t=this.createEl('div',{className:d(Kt,Kt,Qt).call(Kt,this.options)},{},this.buttons.map((t=>t.render())))),this.options.selectable&&m(this,Yt,Jt).call(this,t)),t}get options(){return l(this,Vt)}set arrange(t){const e=Kt.getClassName('arrange');let s=l(this,Ut),n=l(this,Vt);s&&(t?!1===I(s,e)&&R(s,e):F(s,e)),n.arrange=t}set selected(t){const e=Kt.getClassName('selected'),s=this.options;'number'==typeof t&&(t=this.buttons[t]),t instanceof $t&&(this.buttons.forEach((t=>{j(t.element,'data-group-selected'),F(t.element,e)})),R(t.element,e),s.selectIcon&&(t.icon.icon=s.selectIcon,t.options.iconName=s.selectIcon))}}function Qt(t){let e=['button-group'];return t.arrange&&e.push('arrange'),t.scaled&&e.push('scaled'),e}function Jt(t){t.addEventListener('click',(t=>{const e=t.target.closest('.'+Kt.getClassName('button'));this.selected=this.buttons.find((t=>t.element===e))})),t.addEventListener('mouseenter',(t=>{this.$$('.button.selected',t.target).forEach((t=>{!function(t,e,s){t.setAttribute(e,s)}(t,'data-group-selected',!0),F(t,Kt.getClassName('selected'))}))})),t.addEventListener('mouseleave',(t=>{this.$$('.button[data-group-selected]',t.target).forEach((t=>{j(t,'data-group-selected'),R(t,Kt.getClassName('selected'))}))}))}var Zt=new WeakMap,te=new WeakMap,ee=new WeakMap,se=new WeakMap,ne=new WeakMap;class ae extends B{constructor(t,e,s){super(),Zt.set(this,{writable:!0,value:[]}),o(this,'map',{icons:[],actions:[]}),te.set(this,{writable:!0,value:void 0}),ee.set(this,{writable:!0,value:null}),se.set(this,{writable:!0,value:null}),ne.set(this,{writable:!0,value:null}),c(this,te,t),this.map.icons=e,this.map.actions=s,c(this,ee,new It('none','big')),c(this,se,this.createEl('span',{className:'status-text'})),s.forEach((e=>{V(e,{data:{task:t}})})),c(this,ne,new Kt({buttons:s,arrange:!1,scaled:!0}))}render(){let t=l(this,Zt);return t.length>0||(t.push(l(this,ee).render()),t.push(l(this,se)),t.push(l(this,ne).render())),t}refresh(t){l(this,se).innerHTML=l(this,te).statusText,l(this,ee).icon=this.map.icons[t],l(this,ne).buttons.forEach((e=>{let s=e.options?.enabledWithStatus;if('function'==typeof s&&(s=s.call(e,t)),Array.isArray(s)){if(0===e.options.enabledWithStatus.length)return;e.disabled=-1===e.options.enabledWithStatus.indexOf(t)}else'boolean'==typeof s&&(e.disabled=s)}))}}const ie={iconPlacement:'default',parts:{status:'refresh.status',title:'title',text:'text',error:'errors','progress-wrapper':'refresh.progress'},progress:{label:'',size:'',barOptions:{labelText:!1}},actions:[]},re={};re[ht.WAIT]='clock',re[ht.EXEC]='play',re[ht.ERROR]='warning',re[ht.DONE]='checked';var oe=new WeakMap;class le extends gt{constructor(...t){super(...t),oe.set(this,{writable:!0,value:{}})}_renderChild(t){const e=l(this,oe),s=this.options,n=t.appendChild(this.createEl('div',{className:'detail'})),a=t.appendChild(this.createEl('div',{className:'status-wrapper'}));Object.keys(s.parts).forEach((t=>{let i=n,r=null;if('progress-wrapper'===t?s.progress?r=new xt(s.progress):delete s['progress-wrapper']:'status'===t&&(i=a,r=new ae(this,re,s.actions)),e[t]=i.appendChild(this.createEl('div',{className:t},{})),r&&'function'==typeof r?.render){let s=r.render();s instanceof Element&&(s=[s]),s.forEach((s=>e[t].append(s))),d(le,le,ce).call(le,e[t],r)}}))}refresh(t){super.refresh(t,l(this,oe))}_buildCssClass(){const t=super._buildCssClass();return this.options.iconPlacement!==ie.iconPlacement&&t.push('task-item-'+this.options.iconPlacement),t}_refreshProgress(t,e){const s=d(le,le,he).call(le,t);s instanceof xt&&(s.setLabel(this.getProgressTotal()+'%'),s.setProgress(e))}_refreshStatus(t,e){d(le,le,he).call(le,t).refresh(e)}getTitle(){const t=this.options.parts.title;return t?this[t]??'':''}}function ce(t,e){yt.has(t)||yt.set(t,{});yt.get(t).componet=e}function he(t){if(yt.has(t)){const e=yt.get(t);if(void 0!==e.componet)return e.componet}return null}le.Defualts=ie;const ue={linear:t=>t,quad:t=>Math.pow(t,2),circ:t=>1-Math.sin(Math.acos(t)),back:(t=1.5,e)=>Math.pow(e,2)*((t+1)*e-t)},de={fadeOut:function(t){this.style.opacity=1-Math.round(100*t)/100},fadeIn:function(t){'none'===this.style.display&&(this.style.display=null),this.style.opacity=Math.round(100*t)/100}};function pe(t,e={name:'fadeOut',timing:ue.linear,duration:500,delay:0}){let s=Object.assign({},e);if('function'==typeof s.draw)s.draw.bind(t);else{if('string'!=typeof s.name||'function'!=typeof de[s.name])throw new Error('Unknown animation ');s.draw=de[s.name].bind(t)}return'number'!=typeof s.delay&&(s.delay=0),s.timing='string'==typeof s.timing&&'function'==typeof ue[s.timing]?ue[s.timing]:ue.linear,new Promise((e=>{setTimeout((()=>function({timing:t,draw:e,duration:s},n){let a=performance.now();requestAnimationFrame((function i(r){let o=(r-a)/s;o>1&&(o=1);let l=t(o);e(l),o<1?requestAnimationFrame(i):n&&n()}))}(s,(()=>{e(t)}))),s.delay)}))}const fe={common:!1,title:'<h3>Backgrounds tasks</h3>',theme:{'-1':'default'},renderOnEmpty:!0,taskClass:le,emptyText:'Tasks not provided yet',taskOptions:{},tasks:[],statusText:{},hideAnimation:{name:'fadeOut',duration:1e3,timing:'linear',delay:0},showAnimation:{name:'fadeIn',duration:1e3,timing:'linear',delay:0},tasksAnimation:{hide:{},show:{}},resolver:{url:'queue-reader'}};fe.tasksAnimation.hide[ht.DONE]=V({},fe.hideAnimation,{delay:5e3}),fe.tasksAnimation.hide[ht.ERROR]=V({},fe.hideAnimation,{delay:2e4}),fe.tasksAnimation.show[ht.EXEC]=V({},fe.showAnimation,{duration:500}),fe.tasksAnimation.show[ht.WAIT]=V({},fe.showAnimation,{duration:500}),fe.tasksAnimation.hide[ht.ERROR]=!1,fe.statusText[ht.DONE]='Complete',fe.statusText[ht.ERROR]='Complete with errors',fe.statusText[ht.EXEC]='Processing',fe.statusText[ht.WAIT]='Awaiting';var me=new WeakMap,ge=new WeakMap,we=new WeakMap,be=new WeakMap,ve=new WeakSet,Ee=new WeakSet,ye=new WeakSet;class ke extends B{constructor(t){super(),ye.add(this),Ee.add(this),ve.add(this),me.set(this,{writable:!0,value:null}),ge.set(this,{writable:!0,value:{owner:null,wrapper:null,wrapperTasks:null,emptyText:null}}),we.set(this,{writable:!0,value:[]}),be.set(this,{writable:!0,value:{}}),l(this,ge).owner=B.removeOptionsPtoperty('element',t);let e=V({},ke.Defaults,t);c(this,be,V({},{taskOptions:e.taskClass.Defualts},e)),c(this,me,st.factory(this)),this.render(),t.tasks&&void 0!==t.tasks.length&&this.addTasks(t.tasks),setTimeout((()=>{0===this.getTasks().length&&m(this,ve,Te).call(this,'show')}),200),this.trigger(ct.ready,{bubbles:!0})}destroy(){this.trigger(ct.destroy,{bubbles:!0}),c(this,we,[]),this.ownerElement.remove()}get options(){return l(this,be)}trigger(t,e={},s){if('object'==typeof s){e.detail={};for(const[t,n]of Object.entries(s))e.detail[t]=n}return this.ownerElement.dispatchEvent(new dt(this,t,e))}render(){const t=this.getTasks(ht.SET_VISIBLE);if(0===t.length&&!1===this.options.renderOnEmpty)return!1;const e=l(this,ge);if(null===e.wrapper){const t=this.options;e.wrapper=e.owner.appendChild(this.createEl('div',{className:'wrapper'})),0===e.wrapper.childNodes.length&&(t.title&&this.options.title.length>0&&e.wrapper.appendChild(this.createEl('div',{innerHTML:this.options.title,className:'title'})),e.wrapperTasks=e.wrapper.appendChild(this.createEl('div',{className:'tasks'})),t.emptyText.length>0&&(e.emptyText=e.wrapper.appendChild(e.emptyText=this.createEl('div',{className:'empty-wrapper',style:{display:'none'}},{},[this.createEl('span',{className:'empty-text',textContent:t.emptyText})])))),'string'==typeof t.theme&&z(e.wrapper,ke.getClassName('theme-'+t.theme),ke.getClassName('theme'))}return t.forEach((t=>t.refresh())),!0}addTasks(t,e=!0){t&&t.length>0&&(c(this,we,l(this,we).concat(t)),m(this,ve,Te).call(this,'hide').then((()=>{e&&this.resolver.resolve((t=>{t.trigger(ct.fetchStart,{bubbles:!0})}),((t,e)=>{t.trigger(ct.fetchEnd,{bubbles:!0},{requests:e})}))})))}_updateTask(t,e){if(t.progress!==e.progress||t.status!==e.status||t.text!==e.text||t.title!==e.title){const s=t.status!==e.status,n=V({},t);if((t=V(t,e)).refresh(n),s){if(t.cssClassSwitch(),ht.is([ht.EXEC],t.status),this.trigger(ct.statusChange,{bubbles:!0},{task:t,oldStatus:n.status}),ht.is(ht.SET_VISIBLE,t.status)&&null===t.element.parentNode){const e=t.element;e.style.display='none',this.wrapperTasksElement.append(e),pe(e,m(this,Ee,Ce).call(this,t,'show'))}ht.is(ht.SET_COMPLETE,t.status)&&t.element.parentNode instanceof Element&&this.removeTask(t)}}}removeTask(t,e=null){let s=this.getTasks();if('number'==typeof t&&(t=s.find((e=>e.id===t))),t instanceof gt){const s=this.getTasks().findIndex((e=>e.id===t.id));if(s>-1)return l(this,we).splice(s,1),m(this,ye,Ne).call(this,t.element,m(this,Ee,Ce).call(this,t)).then((t=>{e&&e(t),0===l(this,we).length&&m(this,ve,Te).call(this,'show')})),!0}return!1}getTasks(t){let e=l(this,we);const s=this.options.taskClass;return e.forEach(((t,n)=>{t instanceof gt||('object'==typeof t?e[n]=V(new s(null,this),t):Number.parseInt(t)>0&&(e[n]=new s(t,this)))})),t?('number'==typeof t&&(t=[t]),e.filter((e=>{if(t.indexOf(e.status)>-1)return e}))):e}findTask(t){const e=this.getTasks().find((e=>e.id===t));return e instanceof gt?e:null}get ownerElement(){return l(this,ge).owner}get wrapperElement(){return l(this,ge).wrapper}get wrapperTasksElement(){return l(this,ge).wrapperTasks}get resolver(){return l(this,me)}}function Te(t){const e=l(this,ge).emptyText,s=function(t){return!1!==P(t)&&(0!==(''!==t.style?.opacity?parseFloat(t.style.opacity):1)&&'hidden'!==k(t,'visibility')&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length))}(e);return P(e)&&(s&&'hide'===t||!1===s&&'show'===t)?pe(e,this.options[t+'Animation']):Promise.resolve(e)}function Ce(t,e='hide'){const s=this.options;return void 0!==s.tasksAnimation[e][t.status]?s.tasksAnimation[e][t.status]:s[e+'Animation']}function Ne(t,e=this.options.hideAnimation){return!1!==e?pe(t,e).then((t=>(t.remove(),t))):Promise.resolve(!1)}B.classPrefix='qmc-',ke.TaskAbstract=gt,ke.Button=$t,ke.ButtonsGroup=Kt,ke.Icon=It,ke.Defaults=fe,ke.Events=ct,ke.Statuses=ht,a.default.fn.queueManager=function(t){const e=this.data('queue-manager'),s={init:function(t){return this.each(((e,s)=>{const n=a.default(s);n.data('queueManager')||n.data('queueManager',new ke(a.default.extend(!0,{element:n.get(0)},ke.Defaults,t||{},n.data('manager')||{})))})),this},createButtons:function(t,s){(s=s||this).append(a.default(new ke.ButtonsGroup(t).render()).data('manager',e))}};return e instanceof ke&&'function'==typeof e[t]?e[t].apply(e,Array.prototype.slice.call(arguments,1)):s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):'object'!=typeof t&&t?(a.default.error('Method '+t+' does not exist on queueManager '),!1):s.init.apply(this,arguments)},a.default.fn.queueManager.Manager=ke}(window.jQuery,document,window);
