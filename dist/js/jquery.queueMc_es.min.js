/*!
 * @license
 * yii2qmc 1.0.2 <https://github.com/somov/yii2-queue-manager-client#readme>
 * Copyright: somov.nn@gmail.com
 * Licensed under MIT
 */
!function(e,t,s){function a(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}var n=a(e),i=a(t),r=a(s);function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function l(e,t){return p(e,h(e,t,'get'))}function c(e,t,s){return function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw new TypeError('attempted to set read only private field');t.value=s}}(e,h(e,t,'set'),s),s}function h(e,t,s){if(!t.has(e))throw new TypeError('attempted to '+s+' private field on non-instance');return t.get(e)}function u(e,t,s){return f(e,t),function(e,t){if(void 0===e)throw new TypeError('attempted to '+t+' private static field before its declaration')}(s,'get'),p(e,s)}function d(e,t,s){return f(e,t),s}function p(e,t){return t.get?t.get.call(e):t.value}function f(e,t){if(e!==t)throw new TypeError('Private static access of wrong provenance')}function m(e,t,s){if(!t.has(e))throw new TypeError('attempted to get private field on non-instance');return s}const g={prefixed:!0},w=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror','fullscreen'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror','-webkit-full-screen'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror','-moz-full-screen'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError','-ms-fullscreen']],b=w[0];let v;for(let e=0;e<w.length;e++)if(w[e][1]in i.default){v=w[e];break}if(v){for(let e=0;e<v.length;e++)g[b[e]]=v[e];g.prefixed=v[0]!==b[0]}const y=Object.prototype.toString;function E(e,t){(e=>k(e)?Object.keys(e):[])(e).forEach((s=>t(e[s],s)))}function k(e){return!!e&&'object'==typeof e}function T(e,t){if(!e||!t)return'';if('function'==typeof r.default.getComputedStyle){const s=r.default.getComputedStyle(e);return s?s.getPropertyValue(t)||s[t]:''}return''}const C=r.default.navigator&&r.default.navigator.userAgent||'',N=/AppleWebKit\/([\d.]+)/i.exec(C);N&&parseFloat(N.pop()),/iPod/i.test(C),(()=>{const e=C.match(/OS (\d+)_/i);e&&e[1]&&e[1]})();const x=/Android/i.test(C);(()=>{const e=C.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),s=e[2]&&parseFloat(e[2]);t&&s&&parseFloat(e[1]+'.'+e[2])})(),/Firefox/i.test(C);const M=/Edg/i.test(C),O=!M&&(/Chrome/i.test(C)||/CriOS/i.test(C));(()=>{const e=C.match(/(Chrome|CriOS)\/(\d+)/);e&&e[2]&&parseFloat(e[2])})(),(()=>{const e=/MSIE\s(\d+)\.\d/.exec(C);let t=e&&parseFloat(e[1]);!t&&/Trident\/7.0/i.test(C)&&/rv:11.0/.test(C)&&(t=11)})();const S=/Safari/i.test(C)&&!O&&!x&&!M;/Windows/i.test(C);const A=Boolean(i.default===r.default.document&&('ontouchstart'in r.default||r.default.navigator.maxTouchPoints||r.default.DocumentTouch&&r.default.document instanceof r.default.DocumentTouch));/iPad/i.test(C)||S&&A&&/iPhone/i.test(C);function W(e){return'string'==typeof e&&Boolean(e.trim())}function P(e){if(e.indexOf(' ')>=0)throw new Error('class has illegal whitespace characters')}function L(e){return k(e)&&1===e.nodeType}function R(e){return(t,s)=>{if(!W(t))return i.default[e](null);W(s)&&(s=i.default.querySelector(s));const a=L(s)?s:i.default;return a[e]&&a[e](t)}}function _(e='div',t={},s={},a){const n=i.default.createElement(e);return Object.getOwnPropertyNames(t).forEach((e=>{const s=t[e];-1!==e.indexOf('aria-')||'role'===e||'type'===e?n.setAttribute(e,s):'style'===e&&'object'==typeof s?Object.getOwnPropertyNames(s).forEach((e=>{n.style[e]=s[e]})):'textContent'===e?function(e,t){void 0===e.textContent?e.innerText=t:e.textContent=t}(n,s):n[e]===s&&'tabIndex'!==e||(n[e]=s)})),Object.getOwnPropertyNames(s).forEach((e=>{n.setAttribute(e,s[e])})),a&&function(e,t){(function(e){'function'==typeof e&&(e=e());return(Array.isArray(e)?e:[e]).map((e=>('function'==typeof e&&(e=e()),L(e)||function(e){return k(e)&&3===e.nodeType}(e)?e:'string'==typeof e&&/\S/.test(e)?i.default.createTextNode(e):void 0))).filter((e=>e))})(t).forEach((t=>e.appendChild(t)))}(n,a),n}function I(e,t){return P(t),e.classList?e.classList.contains(t):(s=t,new RegExp('(^|\\s)'+s+'($|\\s)')).test(e.className);var s}function j(e,t){return e.classList?e.classList.add(t):I(e,t)||(e.className=(e.className+' '+t).trim()),e}function q(e,t){return e.classList?e.classList.remove(t):(P(t),e.className=e.className.split(/\s+/).filter((e=>e!==t)).join(' ')),e}function F(e,t){e.removeAttribute(t)}function z(e,t,s,a=(e=>e.startsWith(s)?e:'')){let n='';e.classList.forEach((e=>{0===n.length&&(n=a(e))})),n!==t&&(n.length>0&&q(e,n),j(e,t))}var D;/iPhone/i.test(C),(D=Element.prototype).matches=D.matches||D.mozMatchesSelector||D.msMatchesSelector||D.oMatchesSelector||D.webkitMatchesSelector,D.closest=D.closest||function(e){return this?this.matches(e)?this:this.parentElement?this.parentElement.closest(e):null:null};const $=R('querySelector'),B=R('querySelectorAll');class H{static removeOptionsPtoperty(e,t,s=Element){if(t[e]instanceof s==!1)throw Error('Invalid call. Property '+e+' is not valid');{const s=t[e];return delete t[e],s}}createEl(e='div',t={},s={},a){if(void 0!==t.className){const e=new Set;('string'==typeof t.className?t.className.split(' '):t.className).forEach((t=>e.add(t)));let s='';for(let t of e)s+=' '+H.getClassName(t);t.className=s.trim()}return _(e,t,s,a)}static _normalizePrefix(e){return e.replace(new RegExp('\\.','g'),'$&'+H.classPrefix)}$(e,t){return e=H._normalizePrefix(e),$(e,t)}$$(e,t){return e=H._normalizePrefix(e),B(e,t)}}Object.assign(H,{classPrefix:null,getClassName:function(e){return null===this.classPrefix||e.startsWith(this.classPrefix)?e:this.classPrefix+e}});var X,G=(((e,t)=>{var s;s=e=>{e.version='1.2.0';var t=(()=>{for(var e=0,t=new Array(256),s=0;256!=s;++s)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=s)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[s]=e;return'undefined'!=typeof Int32Array?new Int32Array(t):t})();e.table=t,e.bstr=(e,s)=>{for(var a=-1^s,n=e.length-1,i=0;i<n;)a=(a=a>>>8^t[255&(a^e.charCodeAt(i++))])>>>8^t[255&(a^e.charCodeAt(i++))];return i===n&&(a=a>>>8^t[255&(a^e.charCodeAt(i))]),-1^a},e.buf=(e,s)=>{if(e.length>1e4)return((e,s)=>{for(var a=-1^s,n=e.length-7,i=0;i<n;)a=(a=(a=(a=(a=(a=(a=(a=a>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])];for(;i<n+7;)a=a>>>8^t[255&(a^e[i++])];return-1^a})(e,s);for(var a=-1^s,n=e.length-3,i=0;i<n;)a=(a=(a=(a=a>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])])>>>8^t[255&(a^e[i++])];for(;i<n+3;)a=a>>>8^t[255&(a^e[i++])];return-1^a},e.str=(e,s)=>{for(var a,n,i=-1^s,r=0,o=e.length;r<o;)(a=e.charCodeAt(r++))<128?i=i>>>8^t[255&(i^a)]:a<2048?i=(i=i>>>8^t[255&(i^(192|a>>6&31))])>>>8^t[255&(i^(128|63&a))]:a>=55296&&a<57344?(a=64+(1023&a),n=1023&e.charCodeAt(r++),i=(i=(i=(i=i>>>8^t[255&(i^(240|a>>8&7))])>>>8^t[255&(i^(128|a>>2&63))])>>>8^t[255&(i^(128|n>>6&15|(3&a)<<4))])>>>8^t[255&(i^(128|63&n))]):i=(i=(i=i>>>8^t[255&(i^(224|a>>12&15))])>>>8^t[255&(i^(128|a>>6&63))])>>>8^t[255&(i^(128|63&a))];return-1^i}},'undefined'==typeof DO_NOT_EXPORT_CRC?s(t):s({})})(X={exports:{}},X.exports),X.exports);function V(e){return e&&'object'==typeof e&&!Array.isArray(e)}function U(e,...t){if(!t.length)return e;const s=t.shift();if(V(e)&&V(s))for(const t in s)V(s[t])?(e[t]||Object.assign(e,{[t]:{}}),U(e[t],s[t])):Object.assign(e,{[t]:s[t]});return U(e,...t)}const Y={INIT:-1,WAIT:0,EXEC:1,DONE:2,ERROR:3,DELETED:99};Y.SET_VISIBLE=[Y.WAIT,Y.EXEC,Y.ERROR,Y.DONE],Y.SET_COMPLETE=[Y.DONE,Y.ERROR,Y.DELETED],Y.is=(e,t)=>e.indexOf(t)>-1;var K=new WeakMap,Q=new WeakMap,J=new WeakSet;class Z extends H{constructor(e,t){super(),J.add(this),K.set(this,{writable:!0,value:null}),o(this,'id',void 0),o(this,'common',!1),o(this,'initiatorManager',void 0),o(this,'progress',0),o(this,'text',''),o(this,'title',''),o(this,'status',Y.INIT),Q.set(this,{writable:!0,value:null}),this.id=parseInt(e),c(this,K,t)}_renderChild(e){}_buildCssClass(){return['task-item']}cssClassSwitch(){const e=m(this,J,ee).call(this);let t,s;if('object'==typeof this.manager.options.theme){let a=this.manager.options.theme[this.status]||!1;a&&(t=Z.getClassName('theme-'+a),s=Z.getClassName('theme'),z(e,t,s))}t=u(Z,Z,te).call(Z)[this.status],s=Z.getClassName('status'),z(e,t,s)}refresh(e,t=null){m(this,J,ee).call(this),t&&this._refreshElements(t,e)}getProgressTotal(e='progress'){let t=0;return this.hasOwnProperty(e)&&(t=this[e],'object'==typeof t&&t.length&&(t=Math.round(t.reduce(((e,t)=>e+t))/t.length,0))),t}_refreshElements(e,t){const s=this.options.parts;Object.keys(e).forEach((a=>{let n=s[a],i='refreshBasicProperty';if('string'==typeof n){if(n.indexOf('.')>0){let[e,t]=n.split('.');i=e+t[0].toUpperCase()+t.slice(1),n=t}const s=void 0!==this[n]?this[n]:null;s!==(void 0!==t[n]?t[n]:null)&&(i='_'+i,'function'==typeof this[i]&&this[i].call(this,e[a],s,n))}}))}_refreshBasicProperty(e,t,s){if(Array.isArray(t)){const a=Z.getClassName('list-'+s);let n=$('ul.'+a,e);null===n&&(n=this.createEl('ul',{className:a}),e.append(n)),t.forEach(((e,t)=>{let s=$(`li:nth-child(${t+1})`,n);null===s?n.append(_('li',{},{},e)):s.innerText!==e&&(s.innerText=e)}))}else e.innerHTML=t}get manager(){return l(this,K)}get element(){return l(this,Q)}get options(){return this.manager.options.taskOptions}get statusText(){return this.manager.options.statusText[this.status]||''}getTitle(){return''}toString(){return this.statusText+' '+this.getTitle()}}function ee(){if(l(this,Q))return l(this,Q);const e=c(this,Q,this.createEl('div',{className:'wrapper'},{'data-task-id':this.id})),t=this.createEl('div',{className:this._buildCssClass()});return this._renderChild(t),e.append(t),e}var te={writable:!0,value:function(){if(this._cssList)return this._cssList;this._cssList={};for(let e in Y)'number'==typeof Y[e]&&(this._cssList[Y[e]]=H.getClassName('status-'+e.toLowerCase()));return this._cssList}};const se='__EMPTY__',ae={method:'post',delayTime:1e3,params:{}};var ne=new WeakMap,ie=new WeakMap,re=new WeakMap,oe=new WeakSet,le=new WeakSet,ce=new WeakSet;class he{constructor(e){ce.add(this),le.add(this),oe.add(this),ne.set(this,{writable:!0,value:[]}),ie.set(this,{writable:!0,value:void 0}),re.set(this,{writable:!0,value:-1});const t=c(this,ie,U({},ae,e));var s;t.params&&(k(s=t.params)&&'[object Object]'===y.call(s)&&s.constructor===Object)&&(t.params=Object.entries(t.params).map((([e,t])=>`${e}=${t}`)))}resolve(e,t){if(!1===this.isRunning){const s=m(this,ce,fe).call(this);c(this,re,0),s.forEach((t=>e(t))),m(this,oe,ue).call(this,0).catch((e=>{})).then((()=>{const e=l(this,re);return s.forEach((s=>t(s,e))),c(this,re,-1),e}))}}get tasks(){let e=[];return l(this,ne).forEach((t=>{t.getTasks().forEach((t=>{!1===t.common&&e.push(t)}))})),e}get tasksId(){return this.tasks.map((e=>e.id)).filter(((e,t,s)=>s.indexOf(e===t)))}findTasks(e){return this.tasks.filter((t=>t.id===e))}get options(){return l(this,ie)}get isRunning(){return l(this,re)>-1}static factory(e){const t=e.options.resolver,s=G.str(t.url),a=u(he,he,me),n=u(he,he,ge),i=a[s]=a[s]instanceof he?a[s]:new he(t),r=m(i,ce,fe).call(i);return-1===r.indexOf(e)&&(r.push(e),e.options.common&&n.push(e),e.ownerElement.addEventListener(Ct.Events.destroy,(e=>{let t=r.indexOf(e.manager);t>-1&&(n.forEach((e=>{e.getTasks().filter((e=>e.initiatorManager===r[t])).forEach((t=>{e.removeTask(t)}))})),r.splice(t,1)),t=n.findIndex((t=>t===e.manager)),t>-1&&n.splice(t,1)}))),i}}function ue(e=this.options.delayTime){return m(this,le,pe).call(this,e).then((e=>{if(!1===e.ok)throw Error(`${e.status} - ${e.statusText}' `);return e.json().then((e=>(e.length>0&&(e.forEach((e=>{this.findTasks(e.id).forEach((t=>{t.manager._updateTask(t,e)}))})),d(he,he,de).call(he,e,this)),m(this,oe,ue).call(this))))}))}function de(e,t){u(he,he,ge).forEach((s=>{e.forEach((e=>{let a=s.findTask(e.id);null===a&&!1===Y.is(Y.SET_COMPLETE,e.status)&&(e.common=!0,s.addTasks([e.id],!1),a=s.findTask(e.id),s._updateTask(a,e),a.initiatorManager=t.tasks.find((t=>t.id===e.id)).manager),a instanceof Z&&a.common&&s._updateTask(a,e)}))}))}function pe(e){return new Promise(((t,s)=>{const a=this.tasksId;0===a.length?s(se):setTimeout((()=>t(a)),e)})).then((e=>{c(this,re,+l(this,re)+1);let t=e.map((e=>`t[]=${e}`)),s=this.options.params;return Array.isArray(s)&&s.length>0&&(t=t.concat(s)),fetch(this.options.url,U({},this.options,{method:'post',headers:{'Content-type':'application/x-www-form-urlencoded'},body:encodeURI(t.join('&'))}))}))}function fe(e=!1){return!1===e?l(this,ne):l(this,ne).filter((e=>!0===e.options.common))}var me={writable:!0,value:[]},ge={writable:!0,value:[]};const we={ready:'qmc:manager:ready',destroy:'qmc:manager:destroy',statusChange:'qmc:manager:statusChange',taskRemoved:'qmc:manager:taskRemoved',taskElementRemoved:'qmc:manager:taskElementRemoved',newTask:'qmc:manager:newTask',fetchStart:'qmc:resolver:start',fetchEnd:'qmc:resolver:end',toString:function(){const e=[];return E(this,(t=>{e.push(t)})),e.join(' ')}};var be=new WeakMap;class ve extends CustomEvent{constructor(e,t,s){super(t,s),be.set(this,{writable:!0,value:null}),c(this,be,e)}get manager(){return l(this,be)}}let ye,Ee=3;r.default.WeakMap||(ye=class{constructor(){this.vdata='vdata'+Math.floor(r.default.performance&&r.default.performance.now()||Date.now()),this.data={}}set(e,t){const s=e[this.vdata]||Ee++;return e[this.vdata]||(e[this.vdata]=s),this.data[s]=t,this}get(e){const t=e[this.vdata];if(t)return this.data[t]}has(e){return e[this.vdata]in this.data}delete(e){const t=e[this.vdata];t&&(delete this.data[t],delete e[this.vdata])}});var ke=r.default.WeakMap?new WeakMap:new ye,Te=new WeakMap,Ce=new WeakMap,Ne=new WeakMap,xe=new WeakSet;class Me extends H{constructor(...e){super(),xe.add(this),o(this,'label',''),o(this,'className',Me.getClassName('progress')),o(this,'size',null),Te.set(this,{writable:!0,value:[]}),o(this,'barOptions',{}),Ce.set(this,{writable:!0,value:null}),Ne.set(this,{writable:!0,value:null}),o(this,'isShowGradient',!0),U(this,...e)}render(){let e=l(this,Ne);if(e instanceof HTMLElement)return e;let t=this.className;return this.size&&(t+=' '+Me.getClassName('size-'+this.size)),!1===this.isShowGradient&&(t+=' '+Me.getClassName('no-gradient')),e=_('div',{className:t},{},_('div',{className:Me.getClassName('progress-items')})),c(this,Ne,e)}setProgress(e){const t=l(this,Te),s=l(this,Ne);e.length,(e='number'==typeof e?[e]:e).forEach(((e,a)=>{t[a]instanceof We?t[a].progress=e:(t[a]=new We(this.barOptions,{progress:e}),s.querySelector('.'+Me.getClassName('progress-items')).append(_('div',{className:Me.getClassName('progress-item')},{},t[a].render())))}));const a=Me.getClassName('more-than-three');!1===I(s,a)&&e.length>3&&j(s,a)}setLabel(e){e&&(m(this,xe,Oe).call(this).innerHTML=e)}}function Oe(){let e=l(this,Ce);return e instanceof Element||(c(this,Ce,e=_('span',{className:Me.getClassName('progress-label')},{})),l(this,Ne).append(e)),e}o(Me,'$classPrefix',null);var Se=new WeakMap,Ae=new WeakMap;class We{constructor(...e){Se.set(this,{writable:!0,value:!1}),o(this,'className','progress-bar'),Ae.set(this,{writable:!0,value:0}),o(this,'labelText',''),o(this,'min',0),o(this,'max',100),U(this,...e)}render(){let e=l(this,Se);if(e)return e;let t=[];return!1===this.labelText?t.push(_('span',{className:'sr-only',css:{width:0}},{},this.label)):t=this.label,c(this,Se,e=_('div',{className:Me.getClassName(this.className)},{role:'progressbar','aria-valuenow':this.progress,'aria-valuemin':this.min,'aria-valuemax':this.max},t)),e}get label(){const e=this.labelText?this.labelText:'';return`${this.progress}% ${e}`}get progress(){return l(this,Ae)}set progress(e){c(this,Ae,e);const t=this.render();t.setAttribute('aria-valuenow',e),t.childNodes.length>0?t.childNodes[0].textContent=this.label:t.textContent=this.label,t.style.width=`${e}%`}}var Pe=new WeakMap,Le=new WeakMap,Re=new WeakMap,_e=new WeakSet;class Ie extends H{constructor(e=!1,t=!1){super(),_e.add(this),Pe.set(this,{writable:!0,value:void 0}),Le.set(this,{writable:!0,value:!1}),Re.set(this,{writable:!0,value:!1}),c(this,Le,e),c(this,Re,t)}render(){let e=l(this,Pe);return e instanceof Element?e:c(this,Pe,this.createEl('span',{className:m(this,_e,je).call(this)},{},_('span',{},{},['s1','s2','s3'].map((e=>_('span',{className:e}))))))}set icon(e){if(e){let t=l(this,Le);if(t!==e){const s=l(this,Pe);t&&q(s,t),j(s,e),c(this,Le,e)}}}set size(e){if(e){e=Ie.getClassName('size-'+e);const t=l(this,Re);if(t!==e){const s=l(this,Pe);t&&q(s,t),j(s,e),c(this,Re,e)}}}set color(e){B('span[class^=s]',l(this,Pe)).forEach((t=>{t.style.backgroundColor=e}))}}function je(){let e='icon-t',t=[];return l(this,Le)&&(e+=' '+l(this,Le)),t.push(e),l(this,Re)&&t.push('size-'+l(this,Re)),t}const qe={tagName:'button',handler:null,handlerTimoutDelay:500,label:!1,hiddenLabel:'',disabled:!1,size:null,iconName:null,iconHoverName:null,iconSize:null,animatedClick:!0,data:{}};var Fe=new WeakMap,ze=new WeakMap,De=new WeakMap,$e=new WeakSet;class Be extends H{constructor(e){super(),$e.add(this),Fe.set(this,{writable:!0,value:void 0}),ze.set(this,{writable:!0,value:qe}),De.set(this,{writable:!0,value:null}),e&&'object'==typeof e&&c(this,ze,U({},qe,e))}render(){let e=l(this,Fe);if(e instanceof Element)return e;const t=this.options,s=[];if(t.iconName){const e=this.icon;s.push(e.render()),e.icon=t.iconName,e.size=t.iconSize}if(t.label&&s.push(_('p',{},{},t.label)),t.hiddenLabel&&s.push(this.createEl('p',{className:'button-hidden'},{},t.hiddenLabel)),t.animatedClick){const e=_('p',{className:'drop'});e.addEventListener('animationend',(function(){q(this,'animate')})),s.push(e)}return e=c(this,Fe,this.createEl(t.tagName,{className:d(Be,Be,He).call(Be,t)},{},s)),this.disabled=t.disabled,m(this,$e,Xe).call(this,e,t),e}set disabled(e){const t=this.options;e!==t.disabled&&('button'===t.tagName.toLowerCase()?l(this,Fe).disabled=e:function(e,t,s){const a=I(e,t);if('function'==typeof s&&(s=s(e,t)),'boolean'!=typeof s&&(s=!a),s!==a)s?j(e,t):q(e,t)}(l(this,Fe),'disabled'),t.disabled=e)}get options(){return l(this,ze)}get element(){return this.render()}get icon(){let e=l(this,De);return e instanceof Ie?e:c(this,De,new Ie)}}function He(e){let t=['button'];return e.size&&t.push('size-'+e.size),e.hiddenLabel&&t.push('has-hidden'),t}function Xe(e,t){e.addEventListener('click',(s=>{if(t.disabled)return s.stopImmediatePropagation(),!1;t.animatedClick&&d(Be,Be,Ge).call(Be,e)})),'function'==typeof t.handler&&(t.handlerTimoutDelay>0?e.addEventListener('click',(e=>{setTimeout((()=>t.handler.call(this,e)),t.handlerTimoutDelay)})):e.addEventListener('click',t.handler.bind(this))),t.iconHoverName&&(e.addEventListener('mouseenter',(()=>{!1===t.disabled&&(this.icon.icon=t.iconHoverName)})),e.addEventListener('mouseleave',(()=>{this.icon.icon=t.iconName})))}function Ge(e){const t=$('.drop',e);if(t){const s=function(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),s={};return['bottom','height','left','right','top','width'].forEach((e=>{void 0!==t[e]&&(s[e]=t[e])})),s.height||(s.height=parseFloat(T(e,'height'))),s.width||(s.width=parseFloat(T(e,'width'))),s}}(e),a=event.pageX-s.width/2-s.left-window.scrollX,n=event.pageY-s.height/2-s.top-window.scrollY;t.style.top=n+'px',t.style.left=a+'px',j(t,'animate')}}Be.Defaults=qe;const Ve={buttons:[],arrange:!1,scaled:!1,selectable:!1,selectIcon:null};var Ue=new WeakMap,Ye=new WeakMap,Ke=new WeakSet;class Qe extends H{constructor(e){super(),Ke.add(this),o(this,'buttons',null),Ue.set(this,{writable:!0,value:Ve}),Ye.set(this,{writable:!0,value:void 0});const t=H.removeOptionsPtoperty('buttons',e,Array);c(this,Ue,U({},Ve,e)),this.buttons=t.map((e=>new Be(e)))}render(){let e=l(this,Ye);return e instanceof Element||(c(this,Ye,e=this.createEl('div',{className:d(Qe,Qe,Je).call(Qe,this.options)},{},this.buttons.map((e=>e.render())))),this.options.selectable&&m(this,Ke,Ze).call(this,e)),e}get options(){return l(this,Ue)}set arrange(e){const t=Qe.getClassName('arrange');let s=l(this,Ye),a=l(this,Ue);s&&(e?!1===I(s,t)&&j(s,t):q(s,t)),a.arrange=e}set selected(e){const t=Qe.getClassName('selected'),s=this.options;'number'==typeof e&&(e=this.buttons[e]),e instanceof Be&&(this.buttons.forEach((e=>{F(e.element,'data-group-selected'),q(e.element,t)})),j(e.element,t),s.selectIcon&&(e.icon.icon=s.selectIcon,e.options.iconName=s.selectIcon))}}function Je(e){let t=['button-group'];return e.arrange&&t.push('arrange'),e.scaled&&t.push('scaled'),t}function Ze(e){e.addEventListener('click',(e=>{const t=e.target.closest('.'+Qe.getClassName('button'));this.selected=this.buttons.find((e=>e.element===t))})),e.addEventListener('mouseenter',(e=>{this.$$('.button.selected',e.target).forEach((e=>{!function(e,t,s){e.setAttribute(t,s)}(e,'data-group-selected',!0),q(e,Qe.getClassName('selected'))}))})),e.addEventListener('mouseleave',(e=>{this.$$('.button[data-group-selected]',e.target).forEach((e=>{F(e,'data-group-selected'),j(e,Qe.getClassName('selected'))}))}))}var et=new WeakMap,tt=new WeakMap,st=new WeakMap,at=new WeakMap,nt=new WeakMap;class it extends H{constructor(e,t,s){super(),et.set(this,{writable:!0,value:[]}),o(this,'map',{icons:[],actions:[]}),tt.set(this,{writable:!0,value:void 0}),st.set(this,{writable:!0,value:null}),at.set(this,{writable:!0,value:null}),nt.set(this,{writable:!0,value:null}),c(this,tt,e),this.map.icons=t,this.map.actions=s,c(this,st,new Ie('none','big')),c(this,at,this.createEl('span',{className:'status-text'})),s.forEach((t=>{U(t,{data:{task:e}})}))}render(){let e=l(this,et);return e.length>0||(e.push(l(this,st).render()),e.push(l(this,at)),this.map.actions.length>0&&(c(this,nt,new Qe({buttons:this.map.actions,arrange:!1,scaled:!0})),e.push(l(this,nt).render()))),e}refresh(e){l(this,at).innerHTML=l(this,tt).statusText,l(this,st).icon=this.map.icons[e];const t=l(this,nt);t&&t.buttons.forEach((t=>{let s=t.options?.enabledWithStatus;if('function'==typeof s&&(s=s.call(t,e)),Array.isArray(s)){if(0===t.options.enabledWithStatus.length)return;t.disabled=-1===t.options.enabledWithStatus.indexOf(e)}else'boolean'==typeof s&&(t.disabled=s)}))}}const rt={iconPlacement:'default',parts:{status:'refresh.status',title:'title',text:'text',error:'errors','progress-wrapper':'refresh.progress'},progress:{label:'',size:'',barOptions:{labelText:!1}},actions:[]},ot={};ot[Y.WAIT]='clock',ot[Y.EXEC]='play',ot[Y.ERROR]='warning',ot[Y.DONE]='checked';var lt=new WeakMap;class ct extends Z{constructor(...e){super(...e),lt.set(this,{writable:!0,value:{}})}_renderChild(e){const t=l(this,lt),s=this.options,a=e.appendChild(this.createEl('div',{className:'detail'})),n=e.appendChild(this.createEl('div',{className:'status-wrapper'}));Object.keys(s.parts).forEach((e=>{let i=a,r=null;if('progress-wrapper'===e?s.progress?r=new Me(s.progress):delete s['progress-wrapper']:'status'===e&&(i=n,r=new it(this,ot,s.actions)),t[e]=i.appendChild(this.createEl('div',{className:e},{})),r&&'function'==typeof r?.render){let s=r.render();s instanceof Element&&(s=[s]),s.forEach((s=>t[e].append(s))),d(ct,ct,ht).call(ct,t[e],r)}}))}refresh(e){super.refresh(e,l(this,lt))}_buildCssClass(){const e=super._buildCssClass();return this.options.iconPlacement!==rt.iconPlacement&&e.push('task-item-'+this.options.iconPlacement),e}_refreshProgress(e,t){const s=d(ct,ct,ut).call(ct,e);s instanceof Me&&(s.setLabel(this.getProgressTotal()+'%'),s.setProgress(t))}_refreshStatus(e,t){d(ct,ct,ut).call(ct,e).refresh(t)}getTitle(){const e=this.options.parts.title;return e?this[e]??'':''}}function ht(e,t){ke.has(e)||ke.set(e,{});ke.get(e).componet=t}function ut(e){if(ke.has(e)){const t=ke.get(e);if(void 0!==t.componet)return t.componet}return null}ct.Defualts=rt;const dt={linear:e=>e,quad:e=>Math.pow(e,2),circ:e=>1-Math.sin(Math.acos(e)),back:(e=1.5,t)=>Math.pow(t,2)*((e+1)*t-e)},pt={fadeOut:function(e){this.style.opacity=1-Math.round(100*e)/100},fadeIn:function(e){'none'===this.style.display&&(this.style.display=null),this.style.opacity=Math.round(100*e)/100}};function ft(e,t={name:'fadeOut',timing:dt.linear,duration:500,delay:0}){let s=Object.assign({},t);if('function'==typeof s.draw)s.draw.bind(e);else{if('string'!=typeof s.name||'function'!=typeof pt[s.name])throw new Error('Unknown animation ');s.draw=pt[s.name].bind(e)}return'number'!=typeof s.delay&&(s.delay=0),s.timing='string'==typeof s.timing&&'function'==typeof dt[s.timing]?dt[s.timing]:dt.linear,new Promise((t=>{setTimeout((()=>function({timing:e,draw:t,duration:s},a){let n=performance.now();requestAnimationFrame((function i(r){let o=(r-n)/s;o>1&&(o=1);let l=e(o);t(l),o<1?requestAnimationFrame(i):a&&a()}))}(s,(()=>{t(e)}))),s.delay)}))}const mt={common:!1,title:'<h3>Backgrounds tasks</h3>',theme:{'-1':'default'},renderOnEmpty:!0,taskClass:ct,emptyText:'Tasks not provided yet',taskOptions:{},tasks:[],statusText:{},hideAnimation:{name:'fadeOut',duration:1e3,timing:'linear',delay:0},showAnimation:{name:'fadeIn',duration:1e3,timing:'linear',delay:0},tasksAnimation:{hide:{},show:{}},resolver:{url:'queue-reader'}};mt.tasksAnimation.hide[Y.DONE]=U({},mt.hideAnimation,{delay:5e3}),mt.tasksAnimation.hide[Y.ERROR]=U({},mt.hideAnimation,{delay:2e4}),mt.tasksAnimation.show[Y.EXEC]=U({},mt.showAnimation,{duration:500}),mt.tasksAnimation.show[Y.WAIT]=U({},mt.showAnimation,{duration:500}),mt.tasksAnimation.hide[Y.ERROR]=!1,mt.statusText[Y.DONE]='Complete',mt.statusText[Y.ERROR]='Complete with errors',mt.statusText[Y.EXEC]='Processing',mt.statusText[Y.WAIT]='Awaiting';var gt=new WeakMap,wt=new WeakMap,bt=new WeakMap,vt=new WeakMap,yt=new WeakSet,Et=new WeakSet,kt=new WeakSet,Tt=new WeakSet;class Ct extends H{constructor(e){super(),Tt.add(this),kt.add(this),Et.add(this),yt.add(this),gt.set(this,{writable:!0,value:null}),wt.set(this,{writable:!0,value:{owner:null,wrapper:null,wrapperTasks:null,emptyText:null}}),bt.set(this,{writable:!0,value:[]}),vt.set(this,{writable:!0,value:{}}),l(this,wt).owner=H.removeOptionsPtoperty('element',e);let t=U({},Ct.Defaults,e);c(this,vt,U({},{taskOptions:t.taskClass.Defualts},t)),c(this,gt,he.factory(this)),this.render(),e.tasks&&void 0!==e.tasks.length&&this.addTasks(e.tasks),setTimeout((()=>{0===this.getTasks().length&&m(this,yt,Nt).call(this,'show')}),200),this.trigger(we.ready,{bubbles:!0})}destroy(){this.trigger(we.destroy,{bubbles:!0}),c(this,bt,[]),this.ownerElement.remove()}get options(){return l(this,vt)}trigger(e,t={},s){if('object'==typeof s){t.detail={};for(const[e,a]of Object.entries(s))t.detail[e]=a}return this.ownerElement.dispatchEvent(new ve(this,e,t))}render(){const e=this.getTasks(Y.SET_VISIBLE);if(0===e.length&&!1===this.options.renderOnEmpty)return!1;const t=l(this,wt);if(null===t.wrapper){const e=this.options;t.wrapper=t.owner.appendChild(this.createEl('div',{className:'wrapper'})),0===t.wrapper.childNodes.length&&(e.title&&this.options.title.length>0&&t.wrapper.appendChild(this.createEl('div',{innerHTML:this.options.title,className:'title'})),t.wrapperTasks=t.wrapper.appendChild(this.createEl('div',{className:'tasks'})),e.emptyText.length>0&&(t.emptyText=t.wrapper.appendChild(t.emptyText=this.createEl('div',{className:'empty-wrapper',style:{display:'none'}},{},[this.createEl('span',{className:'empty-text',textContent:e.emptyText})])))),'string'==typeof e.theme&&z(t.wrapper,Ct.getClassName('theme-'+e.theme),Ct.getClassName('theme'))}return e.forEach((e=>e.refresh())),!0}addTasks(e,t=!0){if(!1===Array.isArray(e))throw new Error('Not valid call. Argument tasks is not array type ');m(this,kt,Mt).call(this,e),c(this,bt,l(this,bt).concat(e)),e.forEach((e=>this.trigger(we.newTask,{bubbles:!0},{task:e}))),m(this,yt,Nt).call(this,'hide').then((()=>{t&&this.resolver.resolve((e=>{e.getTasks().length>0&&e.trigger(we.fetchStart,{bubbles:!0})}),((e,t)=>{e.trigger(we.fetchEnd,{bubbles:!0},{requests:t})}))}))}_updateTask(e,t){if(e.progress!==t.progress||e.status!==t.status||e.text!==t.text||e.title!==t.title){const s=e.status!==t.status,a=U({},e);if((e=U(e,t)).refresh(a),s){if(e.cssClassSwitch(),this.trigger(we.statusChange,{bubbles:!0},{task:e,oldStatus:a.status}),Y.is(Y.SET_VISIBLE,e.status)&&null===e.element.parentNode){const t=e.element;t.style.display='none',this.wrapperTasksElement.append(t),ft(t,m(this,Et,xt).call(this,e,'show'))}Y.is(Y.SET_COMPLETE,e.status)&&this.removeTask(e)}}}removeTask(e){if('number'==typeof e&&(e=this.findTask(e)),e instanceof Z){const t=this.getTasks().findIndex((t=>t.id===e.id));if(t>-1)return l(this,bt).splice(t,1),this.trigger(we.taskRemoved,{bubbles:!0},{task:e}),e.element.parentNode instanceof Element&&m(this,Tt,Ot).call(this,e.element,m(this,Et,xt).call(this,e)).then((t=>{this.trigger(we.taskElementRemoved,{bubbles:!0},{task:e,element:t}),0===l(this,bt).length&&m(this,yt,Nt).call(this,'show')})),!0}return!1}getTasks(e){let t=l(this,bt);return e?('number'==typeof e&&(e=[e]),t.filter((t=>{if(e.indexOf(t.status)>-1)return t}))):t}findTask(e){const t=this.getTasks().find((t=>t.id===e));return t instanceof Z?t:null}get ownerElement(){return l(this,wt).owner}get wrapperElement(){return l(this,wt).wrapper}get wrapperTasksElement(){return l(this,wt).wrapperTasks}get resolver(){return l(this,gt)}}function Nt(e){const t=l(this,wt).emptyText,s=function(e){return!1!==L(e)&&(0!==(''!==e.style?.opacity?parseFloat(e.style.opacity):1)&&'hidden'!==T(e,'visibility')&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))}(t);if(L(t)){if(s&&'hide'===e||!1===s&&'show'===e)return ft(t,this.options[e+'Animation']);t.style.display='show'===e?'block':'none'}return Promise.resolve(t)}function xt(e,t='hide'){const s=this.options;return void 0!==s.tasksAnimation[t][e.status]?s.tasksAnimation[t][e.status]:s[t+'Animation']}function Mt(e){const t=this.options.taskClass;e.forEach(((s,a)=>{s instanceof Z||('object'==typeof s?e[a]=U(new t(null,this),s):Number.parseInt(s)>0?e[a]=new t(s,this):e.splice(a,1))}))}function Ot(e,t=this.options.hideAnimation){return!1!==t?ft(e,t).then((e=>(e.remove(),e))):Promise.resolve(!1)}H.classPrefix='qmc-',Ct.TaskAbstract=Z,Ct.Button=Be,Ct.ButtonsGroup=Qe,Ct.Icon=Ie,Ct.Defaults=mt,Ct.Events=we,Ct.Statuses=Y,n.default.fn.queueManager=function(e){const t=this.data('queue-manager'),s={init:function(e){return this.each(((t,s)=>{const a=n.default(s);a.data('queueManager')||a.data('queueManager',new Ct(n.default.extend(!0,{element:a.get(0)},Ct.Defaults,e||{},a.data('manager')||{})))})),this},createButtons:function(e,s){(s=s||this).append(n.default(new Ct.ButtonsGroup(e).render()).data('manager',t))}};return t instanceof Ct&&'function'==typeof t[e]?t[e].apply(t,Array.prototype.slice.call(arguments,1)):s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):'object'!=typeof e&&e?(n.default.error('Method '+e+' does not exist on queueManager '),!1):s.init.apply(this,arguments)},n.default.fn.queueManager.Manager=Ct,n.default('document').ready((()=>{n.default('.qmc-queue-manager[data-manager]').queueManager()}))}(window.jQuery,document,window);
